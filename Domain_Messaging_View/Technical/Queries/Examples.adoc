= Examples
:render_as: Level4
:v291_section: 5.9+

== QUERY/RESPONSE MESSAGE EXAMPLES

=== Query by parameter (QBP) / segment pattern response (RSP) 

==== Proposed dispense history example and Query Profile

Example: The user wishes to know all the medications dispensed for the patient whose medical record number is "555444222111" for the period beginning 5/31/98 and ending 5/31/99. The following QBP message is generated:

MSH|^~\&|PCR|Gen Hosp|PIMS||199811201400-0800||QBP^Z81^QBP_Q11|ACK9901|P|2.8||||||||

QPD|Z81^Dispense History^HL7nnnn|Q001|555444222111^^^MPI^MR||19980531|19990531|

RCP|I|999^RD|

The pharmacy system identifies medical record number "555444222111" as belonging to Adam Everyman and locates 4 prescription dispenses for the period beginning 5/31/98 and ending 5/31/99and returns the following RSP message:

MSH|^~\&|PIMS|Gen hosp|PCR||199811201400-0800||RSP^Z82^RSP_Z82|8858|P|2.8||||||||

MSA|AA|ACK9901|

QAK|Q001|OK|Z81^Dispense History^HL7nnnn|4|

QPD|Z81^Dispense History^HL7nnnn|Q001|555444222111^^^MPI^MR||19980531|19990531|

PID|||555444222111^^^MPI^MR||Everyman^Adam||19600614|M||C|2101 Webster # 106^^Oakland^CA^94612||^^^^^510^6271111|^^^^^510^6277654|||||343132266|||N|||||||||

ORC|RE||89968665||||||199805121345-0700|||77^Hippocrates^Harold^H^III^DR^MD||^^^^^510^ 2673600||||||

RXE|1^BID^^19980529|00378112001^Verapamil Hydrochloride 120 mg TAB^NDC |120||mgm||||||||||||||||||||||||||

RXD|1|00378112001^Verapamil Hydrochloride 120 mg TAB^NDC |199805291115-0700|100|||1331665|3|||||||||||||||||

RXR|PO||||

ORC|RE||89968665||||||199805291030-0700|||77^Hippocrates^Harold^H^III^DR^MD||^^^^^510^ 2673600||||||

RXE|1^^D100^^20020731^^^TAKE 1 TABLET DAILY –GENERIC FOR CALAN SR|00182196901^VERAPAMIL HCL ER TAB 180MG ER^NDC |100||180MG|TABLET SA|||G|||0|BC3126631^CHU^Y^L||213220929|0|0|19980821|||

RXD|1|00182196901^VERAPAMIL HCL ER TAB 180MG ER^NDC |19980821|100|||213220929|0|TAKE 1 TABLET DAILY –GENERIC FOR CALAN SR||||||||||||

RXR|PO||||

ORC|RE||235134037||||||199809221330-0700|||8877^Hippocrates^Harold^H^III^DR^MD||^^^^^555^555-5001||||||RXD|1|00172409660^BACLOFEN 10MG TABS^NDC|199809221415-0700|10|||235134037|5|AS DIRECTED||||||||||||

RXR|PO||||

ORC|RE||235134030||||||199810121030-0700|||77^Hippocrates^Harold^H^III^DR^MD||^^^^^555^555-5001||||||

RXD|1|00054384163^THEOPHYLLINE 80MG/15ML SOLN^NDC|199810121145-0700|10|||235134030|5|AS DIRECTED||||||||||||

RXR|PO

===== Associated dispense history Query Profile

Query Profile

[width="100%",cols="39%,61%",options="header",]

|===

|Query Statement ID (Query ID=Z81): |Z81

|Type: |Query

|Query Name: |Dispense History

|Query Trigger (= MSH-9): |QBP^Z81^QBP_Q11

|Query Mode: |Both

|Response Trigger (= MSH-9): |RSP^Z82^RSP_Z82

|Query Characteristics: |May specify patient, medication, a date range, and how the response is to be sorted.

|Purpose: |To retrieve patient pharmacy dispense history information from the Server.

|Response Characteristics: |Sorted by Medication Dispensed unless otherwise specified in *SortControl.*

|Based on Segment Pattern: |RDS_O01

|===

The QBP_Q11 message structure and related choreography can be found in link:#qbprsp-query-by-parametersegment-pattern-response-events-vary[5.4.1].

RSP^Z82^RSP_Z82: Response Grammar: Pharmacy Dispense Message

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec. Ref

|MSH |Message Header | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|MSA |Message Acknowledgement | |2.15.8

|[ERR] |Error | |2.15.5

|link:#QAK[QAK] |Query Acknowledgement | |5.5.2

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|link:#RCP[RCP] |Response Control Parameter | |5.5.6

|\{ |--- QUERY_RESPONSE begin | |

|[ |--- PATIENT begin | |

|PID |Patient Identification | |3.4.2

|[PD1] |Additional Demographics | |3.4.9

|[\{NTE}] |Notes and Comments (for PID) | |2.15.10

|[ |--- VISIT begin | |

|\{AL1} |Allergy Information | |3.4.6

|PV1 |Patient Visit | |3.4.3

|[PV2] |Patient Visit – Additional Info | |3.4.4

|] |--- VISIT end | |

|] |--- PATIENT end | |

|\{ |--- COMMON_ORDER begin | |

|ORC |Common Order | |

|[\{ |--- TIMING begin | |

|TQ1 |Timing/Quantity | |4.5.4

|[\{TQ2}] |Timing/Quantity Order Sequence | |4.5.5

|}] |--- TIMING end | |

|[ |--- ORDER_DETAIL begin | |

|RXO |Pharmacy/Treatment Order | |

|[\{NTE}] |Notes and Comments (for RXO) | |2.15.10

|\{RXR} |Pharmacy/Treatment Route | |

|[ |--- TREATMENT begin | |

|\{RXC} |Pharmacy/Treatment Component | |

|[\{NTE}] |Notes and Comments (for RXC) | |2.15.10

|] |--- TREATMENT end | |

|] |--- ORDER_DETAIL end | |

|[ |--- ENCODED_ORDER begin | |

|RXE |Pharmacy/Treatment Encoded Order | |

|[\{ |--- TIMING_ENCODED begin | |

|TQ1 |Timing/Quantity | |4.5.4

|[\{TQ2}] |Timing/Quantity Order Sequence | |4.5.5

|}] |--- TIMING_ENCODED end | |

|\{RXR} |Pharmacy/Treatment Route | |

|[\{RXC}] |Pharmacy/Treatment Component | |

|] |--- ENCODED_ORDER end | |

|RXD |Pharmacy/Treatment Dispense | |

|\{RXR} |Pharmacy/Treatment Route | |

|[\{RXC}] |Pharmacy/Treatment Component | |

|\{ |--- OBSERVATION begin | |

|[OBX] |Results | |

|[\{NTE}] |Notes and Comments (for OBX) | |2.15.10

|} |--- OBSERVATION end | |

|} |--- COMMON_ORDER end | |

|} |--- QUERY_RESPONSE end | |

|[ DSC ] |Continuation Pointer | |2.15.4

|===

*Input Parameter Specification*

[width="100%",cols="11%,14%,8%,3%,6%,8%,3%,3%,8%,8%,9%,8%,11%",options="header",]

|===

|Field Seq (Query ID=Z81) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|1 |MessageQueryName | | |60 |CWE |R | | | | | |

|2 |QueryTag | | |32 |ST |R | | | | | |

| |PatientList |S |Y |20 |CX |O | | | |PID.3 | |PID-3: Patient Identifier List

| |MedicationDispensed |S |Y |100 |CWE |O | |= | |RXD.2 | |RXD-2: Dispense/Give Code

| |DispenseDate.LL |S |Y |24 |DTM |O | |> +

= | |RXD.3 | |RXD-3: Date/Time Dispensed

| |DispenseDate.UL |S |Y |24 |DTM |O | |< +

= | |RXD.3 | |RXD-3: Date/Time Dispensed

|===

*Input Parameter Field Description and Commentary*

[width="100%",cols="22%,11%,6%,61%",options="header",]

|===

|Input Parameter (Query ID=Z81) |Comp. Name |DT |Description

|*MessageQueryName* | |CWE |SHALL be valued *Z81^Dispense History^HL7nnnn*.

|*QueryTag* | |ST |Unique to each query message instance.

|*PatientList* | |CX |The combination of values for _PatientList.ID, and PatientList.AssigningAuthority,_ are intended to identify a unique entry on the PATIENT_MASTER table. The _PatientList.IdentifierTypeCode_ is useful for further filtering or to supply uniqueness in the event that the assigning authority may have more than one coding system. (The PATIENT_MASTER table contains a constraint that prevents multiple patients from being identified by the same combination of field values.) This PATIENT_MASTER entry will be searched against on the PHARMACY_DISPENSE_TRANSACTION table to retrieve the rows fulfilling the query conditions.

| | | |If this field is not valued, all values for this field are considered to be a match.

| | | |If one PID.3 is specified, only 1 segment pattern will be returned.

| |*ID* |ID |If this field, PID.3.1, is not valued, all values for this field are considered to be a match.

| |*Assigning Authority* |HD |If this field, PID.3.4, is not valued, all values for this field are considered to be a match.

| |*Identifier type code* |CWE |If this field, PID.3.5, is not valued, all values for this field are considered to be a match.

|*MedicationDispensed* | |CWE |If this field is not valued, all values for this field are considered to be a match.

|*DispenseDate.LL* | |DTM |This is the earliest value to be returned for Date/Time Dispensed. If this field is not valued, all values for this field are considered to be a match.

|*DispenseDate.UL* | |DTM |This is the latest value to be returned for Date/Time Dispensed. If this field is not valued, all values for this field are considered to be a match.

|===

==== Comprehensive pharmacy information examples and Query Profile

The user wishes to know all the medications dispensed for the patient whose medical record number is "555444222111" for the period beginning 5/31/98 and ending 5/31/99. The following QBP message is generated:

MSH|^~\&|PCR|Gen Hosp|PIMS||199811201400-0800||QBP^Z85^QBP_Q11|8332|P|2.8||||||||

QPD|Z85^Pharmacy Information Comprehensive^HL7nnnn|Q002|555444222111^^^MPI^MR ||||19980531|19990531||RXO~RXG~RXA|

RCP|I|999^RD|

The pharmacy system identifies medical record number "555444222111" as belonging to Adam Everyman and locates 4 prescription dispenses and an electrolytes panel for the period beginning 5/31/98 and ending 5/31/99and returns the following RSP message:

MSH|^~\&|PIMS|Gen hosp|PCR||199811201400-0800||RSP^Z86^RSP_Z86|8858|P|2.8||||||||

MSA|AA|8332|

QAK|Q002|OK|Z85^Pharmacy Information Comprehensive^HL70003|4|

QPD|Z85^Pharmacy Information Comprehensive^HL7nnnn|Q002|555444222111^^^MPI^MR ||||19980531|19990531||RXO~RXG~RXA|

PID|||555444222111^^^MPI^MR||Everyman^Adam||19600614|M||C|2101 Webster # 106^^Oakland^CA^94612||^^^^^510^6271111|^^^^^510^6277654|||||343132266|||N|||||||||

ORC|RE||89968665||||||199805121345-0700|||77^Hippocrates^Harold^H^III^DR^MD||^^^^^510^ 2673600||||||

RXE|1^BID^^19980529|00378112001^Verapamil Hydrochloride 120 mg TAB^NDC |120||mgm||||||||||||||||||||||||||

RXD|1|00378112001^Verapamil Hydrochloride 120 mg TAB^NDC |199805291115-0700|100|||1331665|3|||||||||||||||||

RXR|PO||||

ORC|RE||89968665||||||199805291030-0700|||77^Hippocrates^Harold^H^III^DR^MD||^^^^^510^ 2673600||||||

RXE|1^^D100^^20020731^^^TAKE 1 TABLET DAILY –GENERIC FOR CALAN SR|00182196901^VERAPAMIL HCL ER TAB 180MG ER^NDC |100||180MG|TABLET SA|||G|||0|BC3126631^CHU^Y^L||213220929|0|0|19980821|||

RXD|1|00182196901^VERAPAMIL HCL ER TAB 180MG ER^NDC |19980821|100|||213220929|0|TAKE 1 TABLET DAILY –GENERIC FOR CALAN SR||||||||||||

RXR|PO||||

ORC|RE||235134037||||||199809221330-0700|||8877^Hippocrates^Harold^H^III^DR^MD||^^^^^555^5555001||||||RXD|1|00172409660^BACLOFEN 10MG TABS^NDC|199809221415-0700|10|||199810310600-0700|5|AS DIRECTED||||||||||||

RXR|PO||||

ORC|RE||235134030||||||199810121030-0700|||77^Hippocrates^Harold^H^III^DR^MD||^^^^^555^5555001||||||

RXD|1|00054384163^THEOPHYLLINE 80MG/15ML SOLN^NDC|199810121145-0700|10|||235134030|5|AS DIRECTED||||||||||||

RXR|PO

OBX|1|ST|2951-2^SODIUM^LN||150|mmol/l|136‑148|H||A|F|19850301||199811180700-0800

OBX|2|ST|2823-3^POTASSIUM^LN||4.5|mmol/l|3.5‑5|N||N|F|19850301||199811180700-0800

OBX|3|ST|2075-0^CHLORIDE^LN||102|mmol/l|94‑105|N||N|F|19850301||199811180700-0800

OBX|4|ST|2028-9^CARBON DIOXIDE^LN||27|mmol/l|24‑31|N||N|F|19850301||199811180700-0800

...

Note the use of _OBX-14-Date/time of the observation_ to time the laboratory observations.

===== Comprehensive pharmacy information Query Profile

The following is a highly experimental approach to establishing a super segment pattern response to a general purpose query structure. It contains all of the pharmacy information segments as possible inclusions in the response. It differs from previously defined segment pattern queries in that it cuts across multiple related standard HL7 messages although there is a logical hierarchy that can be determined.

Query Profile

[width="100%",cols="39%,61%",options="header",]

|===

|Query Statement ID (Query ID=Z85): |Z85

|Type: |Query

|Query Name: |Pharmacy Information Comprehensive

|Query Trigger (= MSH-9): |QBP^Z85^QBP_Q11

|Query Mode: |Both

|Response Trigger (= MSH-9): |RSP^Z86^RSP_Z86

|Query Characteristics: |May specify patient, medication, a date range, how the response is to be sorted, and what segment groups are to be returned.

|Purpose: |To retrieve patient pharmacy history information from the Server.

|Response Characteristics: |Sorted by Medication Dispensed unless otherwise specified in *SortControl.*

|Based on Segment Pattern: |

|===

The QBP_Q11 message structure and related choreography can be found in link:#qbprsp-query-by-parametersegment-pattern-response-events-vary[5.4.1]

RSP^Z86^RSP_Z86: Response Grammar: Pharmacy Information Comprehensive

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec. Ref

|MSH |Message Header | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|MSA |Message Acknowledgement | |2.15.8

|[ERR] |Error | |2.15.5

|link:#QAK[QAK] |Query Acknowledgement | |5.5.2

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|\{ |--- QUERY_RESPONSE begin | |

|[ |--- PATIENT begin | |

|PID |Patient Identification | |3.4.2

|[PD1] |Additional Demographics | |3.4.9

|[\{NTE}] |Notes and Comments (for PID) | |2.15.10

|[\{AL1}] |Allergy Information | |3.4.6

|] |--- PATIENT end | |

|\{ |--- COMMON_ORDER begin | |

|ORC |Common Order | |4.5.3

|[\{ |--- TIMING begin | |

|TQ1 |Timing/Quantity | |4.5.4

|[\{TQ2}] |Timing/Quantity Order Sequence | |4.5.5

|}] |--- TIMING end | |

|[ |--- ORDER_DETAIL begin | |

|RXO |Pharmacy/Treatment Order | |4.14.1

|\{RXR} |Pharmacy/Treatment Route | |4.14.2

|[\{RXC}] |Pharmacy/Treatment Component | |4.14.3

|] |--- ORDER_DETAIL end | |

|[ |--- ENCODED_ORDER begin | |

|RXE |Pharmacy/Treatment Encoded Order | |4.14.4

|[\{ |--- TIMING_ENCODED begin | |

|TQ1 |Timing/Quantity | |4.5.4

|[\{TQ2}] |Timing/Quantity Order Sequence | |4.5.5

|}] |--- TIMING_ENCODED end | |

|\{RXR} |Pharmacy/Treatment Route | |4.14.2

|[\{RXC}] |Pharmacy/Treatment Component | |4.14.3

|] |--- ENCODED_ORDER end | |

|[ |--- DISPENSE begin | |

|RXD |Pharmacy/Treatment Dispense | |4.14.5

|\{RXR} |Pharmacy/Treatment Route | |4.14.2

|[\{RXC}] |Pharmacy/Treatment Component | |4.14.3

|] |--- DISPENSE end | |

|[ |--- GIVE begin | |

|RXG |Pharmacy/Treatment Give | |4.14.6

|\{RXR} |Pharmacy/Treatment Route | |4.14.2

|[\{RXC}] |Pharmacy/Treatment Component | |4.14.3

|] |--- GIVE end | |

|[ |--- ADMINISTRATION begin | |

|RXA |Pharmacy/Treatment Administration | |4.14.7

|\{RXR} |Pharmacy/Treatment Route | |4.14.2

|[\{RXC}] |Pharmacy/Treatment Component | |4.14.3

|] |--- ADMINISTRATION end | |

|\{ |--- OBSERVATION begin | |

|[OBX] |Results | |7.4.2

|[\{NTE}] |Notes and Comments (for OBX) | |2.15.10

|} |--- OBSERVATION end | |

|} |--- COMMON_ORDER end | |

|} |--- QUERY_RESPONSE end | |

|[DSC] |Continuation Pointer | |2.15.4

|===

*QPD Input Parameter Specification*

[width="100%",cols="11%,14%,8%,3%,6%,8%,3%,3%,8%,8%,9%,8%,11%",options="header",]

|===

|Field Seq (Query ID=Z85) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|1 |MessageQueryName | | |60 |CWE |R | | | | | |

|2 |QueryTag | | |32 |ST |R | | | | | |

|3 |PatientList |*S* |*Y* |*20* |*CX* |*O* | | | |PID.3 | |PID-3: Patient Identifier List

|4 |OrderControlCode |S | |2 |ID | |Y | |0119 |ORC.1 | |ORC-1: Order Control

|5 |OrderingProvider |S | |120 |XCN | | | | |ORC.12 | |ORC-12: Ordering Provider

|6 |MedicationDispensed |S |Y |100 |CWE |O | |= | |RXD.2 | |RXD-2: Dispense/Give Code

|7 |DispenseDate.LL |S |Y |24 |DTM |O | |> +

= | |RXD.3 | |RXD-3: Date/Time Dispensed

|8 |DispenseDate.UL |S |Y |24 |DTM |O | |< +

= | |RXD.3 | |RXD-3: Date/Time Dispensed

|===

*QPD Input Parameter Field Description and Commentary*

[width="100%",cols="22%,11%,6%,61%",options="header",]

|===

|Input Parameter (Query ID=Z85) |Comp. Name |DT |Description

|*MessageQueryName* | |CWE |SHALL be valued *Z85^Pharmacy Information Comprehensive^HL7nnnn*.

|*QueryTag* | |ST |Unique to each query message instance.

|*PatientList* | |CX |The combination of values for _PatientList.ID, and PatientList.AssigningAuthority,_ are intended to identify a unique entry on the PATIENT_MASTER table. The _PatientList.IdentifierTypeCode_ is useful for further filtering or to supply uniqueness in the event that the assigning authority may have more than one coding system. (The PATIENT_MASTER table contains a constraint that prevents multiple patients from being identified by the same combination of field values.) This PATIENT_MASTER entry will be searched against on the PHARMACY_DISPENSE_TRANSACTION table to retrieve the rows fulfilling the query conditions.

| | | |If this field is not valued, all values for this field are considered to be a match.

| | | |If one PID.3 is specified, only 1 segment pattern will be returned.

| |*ID* |ID |If this field, PID.3.1, is not valued, all values for this field are considered to be a match.

| |*Assigning Authority* |HD |If this field, PID.3.4, is not valued, all values for this field are considered to be a match.

| |*Identifier type code* |IS |If this field, PID.3.5, is not valued, all values for this field are considered to be a match.

|*OrderControlCode* | |ID |If this field, ORC.1, is not valued, all values for this field are considered to be a match.

|*OrderingProvider* | |XCN |If this field, ORC.12, is not valued, all values for this field are considered to be a match.

|*MedicationDispensed* | |CWE |If this field is not valued, all values for this field are considered to be a match.

|*DispenseDate.LL* | |DTM |This is the earliest value to be returned for Date/Time Dispensed. If this field is not valued, all values for this field are considered to be a match.

|*DispenseDate.UL* | |DTM |This is the latest value to be returned for Date/Time Dispensed. If this field is not valued, all values for this field are considered to be a match.

|===

*RCP Response Control Parameter Field Description and Commentary*

[width="100%",cols="13%,27%,11%,7%,7%,35%",options="header",]

|===

|Field Seq (Query ID=Z85) |Name |Com­po­nent Name |LEN |DT |Description

|1 |Query Priority | |1 |ID |(*D*)eferred or (*I*)mmediate. Default is *I*.

|2 |Quantity Limited Request | |10 |CQ |

| | |Quantity | |NM |Number of units (specified by the following component) that will be returned in each increment of the response. If no value is given, the entire response will be returned in a single increment.

| | |Units | |CWE |**Ch**aracters, **Li**nes, **P**a**G**es, or **R**ecor**D**s. Default is *LI*.

|3 |Response Modality | |60 |CWE |**R**eal time or **B**atch. Default is *R*.

|7 |Segment group inclusion | |256 |ID |What segment group(s) are to be included. If this field is not valued, all segment groups will be included.

|===

=== Query using QSC variant / segment pattern response examples

==== Dispense information example and Query Profile

The following example demonstrates that the same results, as shown in the example in 5.9.1.1, can be obtained using the QSC variant. The difference is how the input parameters are expressed.

The user wishes to know all the medications dispensed for the patient whose medical record number is "555444222111" for the period beginning 5/31/98 and ending 5/31/99. The following message is generated:

MSH|^~\&|PCR|Gen Hosp|PIMS||199811201300-0800||QBP^Z87^QBP_Q11|8698|P|2.8||||||||

QPD|Z87^Dispense Information^HL7nnnn|Q001|@PID.3^EQ^55544422211^AND|@ORC.1^EQ^RE^ mailto:AND|@RXD.3%5eGE%5e199805310000-0800%5eAND|@RXD.3%5eLE%5e199905310000-0800[AND|@RXD.3^GE^199805310000-0800^AND|@RXD.3^LE^199905310000-0800]

RCP|I|999^RD|

The pharmacy system identifies medical record number "555444222111" as belonging to Adam Everyman and locates 4 prescription dispenses for the period beginning 5/31/98 and ending 5/31/99 and returns the following RSP message:

MSH|^~\&|PIMS|Gen Hosp|PCR||199811201300-0800||RSP^Z88^RSP_Z88|8857|P|2.8||||||||

MSA|AA|8698|

QAK|Q001|OK|Z87^Dispense Information^HL7nnnn|4

QPD|Z87^Dispense Information^HL7nnnn|Q001|@PID.3^EQ^55544422211^AND~ORC.1^EQ^RE^ mailto:AND~@RXD.3%5eGE%5e199805310000-0800%5eAND~@RXD.3%5eLE%5e199905310000-0800[AND~@RXD.3^GE^199805310000-0800^AND~@RXD.3^LE^199905310000-0800]

PID|||555444222111^^^MPI^MR||Everyman^Adam||19600614|M||C|2101 Webster # 106^^Oakland^CA^94612||^^^^^510^6271111|^^^^^510^6277654|||||343132266|||N|||||||||

ORC|RE||89968665||||||199905121345-0700|||77^Hippocrates^Harold^H^III^DR^MD||^^^^^510^ 2673600||||||

RXE|1^BID^^19990529|00378112001^Verapamil Hydrochloride 120 mg TAB^NDC |120||mgm||||||||||||||||||||||||||

RXD|1|00378112001^Verapamil Hydrochloride 120 mg TAB^NDC|199905291115-0700|100|||1331665|3|||||||||||||||||

RXR|PO||||

ORC|RE||89968665||||||199905291030-0700|||77^Hippocrates^Harold^H^III^DR^MD||^^^^^510^ 2673600||||||

RXE|1^^D100^^20020731^^^TAKE 1 TABLET DAILY –GENERIC FOR CALAN SR|00182196901^VERAPAMIL HCL ER TAB 180MG ER^NDC|100||180MG|TABLET SA|||G|||0|BC3126631^CHU^Y^L||213220929|0|0|19990821|||

RXD|1|00182196901^VERAPAMIL HCL ER TAB 180MG ER^NDC|19990821|100|||213220929|0|TAKE 1 TABLET DAILY –GENERIC FOR CALAN SR||||||||||||

RXR|PO||||

ORC|RE||235134037||||||199809221330-0700|||88^Seven^Henry^^^DR^MD||^^^^^510^ 2673900||||||

RXD|1|00172409660^BACLOFEN 10MG TABS^NDC|199809221415-0700|10|||235134037|5|AS DIRECTED||||||||||||

RXR|PO||||

ORC|RE||235134030||||||199810121030-0700|||99^Assigned^Amanda^^^DR^MD||^^^^^510^ 2673700||||||

RXD|1|00054384163^THEOPHYLLINE 80MG/15ML SOLN^NDC|199810121145-0700|10|||235134030|5|AS DIRECTED||||||||||||

RXR|PO

===== Associated dispense information Query Profile

Note that the following Query Profile contains many more input parameters. The user is allowed to populate as many of these as desired.

Query Profile

[width="100%",cols="39%,61%",options="header",]

|===

|Query Statement ID (Query ID=Z87): |Z87

|Type: |Query

|Query Name: |Dispense Information

|Query Trigger (= MSH-9): |QBP^Z87^QBP_Q11

|Query Mode: |Both

|Response Trigger (= MSH-9): |RSP^Z88^RSP_Z88

|Query Characteristics: |Selection criteria are chosen from a Virtual Table. May specify patient, medication, and a date range.

|Purpose: |To retrieve patient pharmacy dispense history information from the Server.

|Response Characteristics: |Sorted by Medication Dispensed unless otherwise specified in *SortControl.*

|Based on Segment Pattern: |RDS_O01

|===

QBP^Z87^QBP_Q11: Query Grammar: QBS Message

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec. Ref

|MSH |Message Header Segment | |2.15.9

|[\{ARV}] |Access Restriction | |3

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|[ |--- QBP begin | |

|[...] |Optional query by example segments | |

|] |--- QBP end | |

|link:#RCP[RCP] |Response Control Parameter | |5.5.6

|[ DSC ] |Continuation Pointer | |2.15.4

|===

RSP^Z88^RSP_Z88: Response Grammar: Pharmacy Information Comprehensive

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec. Ref

|MSH |Message Header | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|MSA |Message Acknowledgement | |2.15.8

|[ERR] |Error | |2.15.5

|link:#QAK[QAK] |Query Acknowledgement | |5.5.2

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|link:#RCP[RCP] |Response Control Parameter | |5.5.6

|\{ |--- QUERY_RESPONSE begin | |

|[ |--- PATIENT begin | |

|PID |Patient Identification | |3.4.2

|[PD1] |Additional Demographics | |3.4.10

|[\{NTE}] |Notes and Comments (for PID) | |2.15.10

|[ |--- ALLERGY begin | |

|\{AL1} |Allergy Information | |3.4.5

|[ |--- VISIT begin | |

|PV1 |Patient Visit | |3.4.3

|[PV2] |Patient Visit – Additional Info | |3.4.4

|] |--- VISIT begin | |

|] |--- ALLERGY end | |

|] |--- PATIENT end | |

|\{ |--- COMMON_ORDER begin | |

|ORC |Common Order | |4.5.1

|[\{ |--- TIMING begin | |

|TQ1 |Timing/Quantity | |4.5.4

|[\{TQ2}] |Timing/Quantity Order Sequence | |4.5.5

|}] |--- TIMING end | |

|[ |--- ORDER_DETAIL begin | |

|RXO |Pharmacy/Treatment Order | |4.8.2

|[\{NTE}] |Notes and Comments (for RXO) | |2.15.10

|\{RXR} |Pharmacy/Treatment Route | |4.14.2

|[ |--- COMPONENT begin | |

|\{RXC} |Pharmacy/Treatment Component | |4.14.3

|[\{NTE}] |Notes and Comments (for RXC) | |2.15.10

|] |--- COMPONENT end | |

|] |--- ORDER_DETAIL end | |

|[ |--- ORDER_ENCODED begin | |

|RXE |Pharmacy/Treatment Encoded Order | |4.8.7

|[\{ |--- TIMING_ENCODED begin | |

|TQ1 |Timing/Quantity | |4.5.4

|[\{TQ2}] |Timing/Quantity Order Sequence | |4.5.5

|}] |--- TIMING_ENCODED end | |

|\{RXR} |Pharmacy/Treatment Route | |4.14.2

|[\{RXC}] |Pharmacy/Treatment Component | |4.14.3

|] |--- ORDER_ENCODED end | |

|RXD |Pharmacy/Treatment Dispense | |4.8.10

|\{RXR} |Pharmacy/Treatment Route | |4.14.2

|[\{RXC}] |Pharmacy/Treatment Component | |4.14.3

|\{ |--- OBSERVATION begin | |

|[OBX] |Results | |7.4.2

|[\{NTE}] |Notes and Comments (for OBX) | |2.15.10

|} |--- OBSERVATION end | |

|} |--- COMMON_ORDER end | |

|} |--- QUERY_RESPONSE end | |

|DSC |Continuation Pointer | |2.15.4

|===

*QPD Input Parameter Specification*

[width="100%",cols="11%,14%,8%,3%,6%,8%,3%,3%,8%,8%,9%,8%,11%",options="header",]

|===

|Field Seq (Query ID=Z87) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|1 |MessageQueryName | | |60 |CWE |R | | | | | |

|2 |QueryTag | | |32 |ST |R | | | | | |

|3 |SelectionCriteria | | |*255* |*ST* |*R* |*Y* | | | | |

|===

*QPD Input Parameter Field Description and Commentary*

[width="100%",cols="21%,11%,6%,62%",options="header",]

|===

|Input Parameter (Query ID=Z87) |Comp. Name |DT |Description

|MessageQueryName | |CWE |SHALL be valued *Z87^Dispense Information^HL7nnnn*.

|QueryTag | |ST |Unique to each query message instance.

|SelectionCriteria | |ST |A query expression whose operands are derived from the 'ColName' column in the 'Input Specification: Virtual Table' given below.

|===

*Input Specification: Virtual Table*

[width="100%",cols="23%,7%,5%,5%,6%,5%,5%,7%,6%,9%,9%,13%",options="header",]

|===

|ColName (Query ID=Z87) a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|PatientList |S |Y |20 |CX |O | | | |PID.3 | |PID-3: Patient Identifier List

|PatientName | | |48 |XPN | | | | |PID.5 | |PID-5 Patient Name

|OrderControlCode |S | |2 |ID | | | |0119 |ORC.1 | |ORC-1 Order Control

|MedicationDispensed |S |Y |100 |CWE | | | | |RXD.2 | |RXD-2 Dispense/Give Code

|DispenseDate |S | |26 |DTM | | | | |RXD.3 | |RXD-2 Date/Time Dispensed

|QuantityDispensed |L | |20 |NM | | | | |RXD.4 | |RXD-4 Actual Dispense Amount

|OrderingProvider |S | |120 |XCN | | | | |ORC.12 | |ORC-12 Ordering Provider

|===

*Virtual Table Field Description and Commentary*

[width="100%",cols="21%,11%,6%,62%",options="header",]

|===

|ColName (Query ID=Z87) |Comp. Name |DT |Description

|PatientList | |CX |The combination of values for _PatientList.ID, and PatientList.AssigningAuthority,_ are intended to identify a unique entry on the PATIENT_MASTER table. The _PatientList.IdentifierTypeCode_ is useful for further filtering or to supply uniqueness in the event that the assigning authority may have more than one coding system. (The PATIENT_MASTER table contains a constraint that prevents multiple patients from being identified by the same combination of field values.) This PATIENT_MASTER entry will be searched against on the PHARMACY_DISPENSE_TRANSACTION table to retrieve the rows fulfilling the query conditions.

| | | |If this field is not valued, all values for this field are considered to be a match.

| | | |If one PID.3 is specified, only 1 segment pattern will be returned

| |*ID* |ID |If this field, PID.3.1, is not valued, all values for this field are considered to be a match.

| |*Assigning Authority* |HD |If this field, PID.3.4, is not valued, all values for this field are considered to be a match.

| |*Identifier type code* |IS |If this field, PID.3.5, is not valued, all values for this field are considered to be a match.

|OrderControlCode | |ID |If this field, ORC.1, is not valued, all values for this field are considered to be a match.

|MedicationDispensed | |CWE |If this field, RXD.2, is not valued, all values for this field are considered to be a match.

|DispenseDate | |DTM |If this field, RXD.3, is not valued, all values for this field are considered to be a match.

|QuantityDispensed | |NM |If this field, RXD.4, is not valued, all values for this field are considered to be a match.

|OrderingProvider | |XCN |If this field, ORC.12, is not valued, all values for this field are considered to be a match.

|===

*RCP Response Control Parameter Field Description and Commentary*

[width="100%",cols="13%,27%,11%,7%,7%,35%",options="header",]

|===

|Field Seq (Query ID=Z87) |Name |Com­po­nent Name |LEN |DT |Description

|1 |Query Priority | |1 |ID |(*D*)eferred or (*I*)mmediate. Default is *I*.

|2 |Quantity Limited Request | |10 |CQ |

| | |Quantity | |NM |Number of units (specified by the following component) that will be returned in each increment of the response. If no value is given, the entire response will be returned in a single increment.

| | |Units | |CWE |**CH**aracters, **LI**nes, **P**a**G**es, or **R**ecor**D**s. Default is *LI*.

|3 |Response Modality | |60 |CWE |**R**eal time or **B**atch. Default is *R*.

|7 |Segment group inclusion | |256 |ID |What segment group(s) are to be included. If this field is not valued, all segment groups will be included.

|===

==== Dispense information query showing different instantiation

The following example shows how the same QSC style query can be invoked in a very different way producing very different results.

The user wishes to know all the medications ever dispensed for the patient whose medical record number is "555444222111" prescribed by Dr Lister (provider number 99). The following message is generated. Note that the same Query has been used, but different input specifications were used.

MSH|^~\&|PCR|Gen Hosp|PIMS||199811201300-0800||QBP^Z87^QBP_Q11|8698|P|2.8||||||||

QPD|Q33^Dispense Information^HL7nnnn|Q005| @PID.3^EQ^55544422211^AND|@ORC.1^EQ^RE^AND|@ORC.12.1^EQ^99

RCP|I|999^RD|

The pharmacy system identifies medical record number "555444222111" as belonging to Adam Everyman and locates 2 prescription dispenses as prescribed by Dr. Lister. The response is clearly different than the response to the first query.

MSH|^~\&|PIMS|Gen Hosp|PCR||199811201300-0800||RSP^Z88^RSP_Z88|8857|P|2.8||||||||

MSA|AA|8698|

QAK|Q005|OK|Q33^Dispense Information^HL7nnnn|2|

QPD|Q33^Dispense Information^HL7nnnn|Q005| @PID.3^EQ^55544422211^AND~@ORC.1^EQ^RE^AND~@ORC.12.1^EQ^99

PID|||555444222111^^^MPI^MR||Everyman^Adam||19600614|M||C|2101 Webster # 106^^Oakland^CA^94612||^^^^^510^6271111|^^^^^510^6277654|||||343132266|||N|||||||||

ORC|RE||89968665||||||199603121345-0700|||99^Assigned^Amanda^^^DR^MD ||^^^^^510^ 2673600||||||

RXE|1^BID^^19980529|00182196901^VERAPAMIL HCL ER TAB 180MG ER^NDC |120||mgm||||||||||||||||||||||||||

RXD|1|00182196901^VERAPAMIL HCL ER TAB 180MG ER^NDC|199603122000-0700|100|||1331665|3|||||||||||||||||

RXR|PO||||

ORC|RE||235134030||||||199810121030-0700|||88^PRIMARY^PATRICIA^H^III^DR^MD||^^^^^555^ 5551004||||||

RXD|1|00054384163^THEOPHYLLINE 80MG/15ML SOLN^NDC|199810121145-0700|10|||235134030|5|AS DIRECTED||||||||||||

RXR|PO

==== Lab results history example

The user wishes to know all the lab results for the patient whose medical record is 80302641876 and where the result report date/time is between March 21, 1999 and June 24, 1999 and the Lab department is chemistry. This Query Name might be invoked once with a query tag of 123 in the following manner:

MSH|^~\&| PCR|Gen Hosp|LIS.RMS||199907131030-0800||QBP^Z89^QBP_Q11|4460|P|2.8|

QPD|Z89^Lab Results History^HL7nnnn|123|@PID.3.1.1^EQ^80302641876^AND| @OBR.22^GE^19990321^AND|@OBR.22^LE^19990624^AND|@OBR.24^EQ^"CHEMISTRY"

RCP|I||R|

==== Lab results history Query Profile

The "Lab Results History" query returns laboratory results information in the form of the Segment Pattern Response corresponding to the ORU^R01 – unsolicited transmission of an observation message. It returns all of the results which meet the criteria defined in the QPD – Query Parameter Definition Segment of the RSP^R11 – Segment Pattern Response message.

Query Profile

[width="100%",cols="39%,61%",options="header",]

|===

|Query Statement ID (Query ID=Z89): |Z89

|Type: |Query

|Query Name: |Lab Results History

|Query Trigger (= MSH-9): |QBP^Z89^QBP_Q11

|Query Mode: |Both

|Response Trigger (= MSH-9): |RSP^Z90^RSP_Z90

|Query Characteristics: |May specify patient, report time, laboratory department, and LOINC code of result to be returned.

|Purpose: |To retrieve patient laboratory results information from the Server.

|Response Characteristics: |

|Based on Segment Pattern: |ORU_O01

|===

QBP^Z89^QBP_Q11: Query Grammar: QBS Message

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec Ref

|MSH |Message Header Segment | |2.15.9

|[\{ARV}] |Access Restriction | |3

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|[ |--- QBP begin | |

|[...] |Optional query by example segments | |

|] |--- QBP end | |

|link:#RCP[RCP] |Response Control Parameter | |5.5.6

|[ DSC ] |Continuation Pointer | |2.15.4

|===

RSP^Z90^RSP_Z90: Response Grammar: Pharmacy Information Comprehensive

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec Ref

|MSH |Message Header | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|MSA |Message Acknowledgement | |2.15.8

|[ERR] |Error | |2.15.5

|link:#QAK[QAK] |Query Acknowledgement | |5.5.2

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|link:#RCP[RCP] |Response Control Parameter | |5.5.6

|\{ |--- QUERY_RESPONSE begin | |

|[ |--- PATIENT begin | |

|PID |Patient Identification | |3.4.2

|[PD1] |Additional Demographics | |3.4.10

|[\{NK1}] |Next of Kin/Associated Parties | |3.4.5

|[\{NTE}] |Notes and Comments (for PID) | |2.15.10

|[ |--- VISIT begin | |

|PV1 |Patient Visit | |3.4.3

|[PV2] |Patient Visit – Additional Info | |3.4.4

|] |--- VISIT end | |

|] |--- PATIENT end | |

|\{ |--- COMMON_ORDER begin | |

|ORC |Common Order | |4.5.1

|[\{ |--- TIMING begin | |

|TQ1 |Timing/Quantity | |4.5.4

|[\{TQ2}] |Timing/Quantity Order Sequence | |4.5.5

|}] |--- TIMING end | |

|OBR |Observations Report ID | |4.5.3

|[\{NTE}] |Notes and Comments (for ORC/OBR) | |2.15.10

|[CTD] |Contact Data | |11.6.4

|\{ |--- OBSERVATION begin | |

|[OBX] |Observation/Result | |7.4.2

|[\{NTE}] |Notes and Comments (for OBX) | |2.15.10

|} |--- OBSERVATION end | |

|} |--- COMMON_ORDER end | |

|[\{ |--- SPECIMEN begin | |

|SPM |Specimen | |7.4.3

|[\{OBX}] |Observation Related to Specimen | |7.4.2

|}] |--- SPECIMEN end | |

|} |--- QUERY_RESPONSE end | |

|DSC |Continuation Pointer | |2.15.4

|===

*QPD Input Parameter Specification*

[width="100%",cols="11%,14%,8%,3%,6%,8%,3%,3%,8%,8%,9%,8%,11%",options="header",]

|===

|Field Seq (Query ID=Z89) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|1 |MessageQueryName | | |60 |CWE |R | | | | | |

|2 |QueryTag | | |32 |ST |R | | | | | |

|3 |SelectionCriteria | | |*255* |*ST* |*R* |*Y* | | | | |

|===

*QPD Input Parameter Field Description and Commentary*

[width="100%",cols="21%,11%,6%,62%",options="header",]

|===

|Input Parameter (Query ID=Z89) |Comp. Name |DT |Description

|MessageQueryName | |CWE |SHALL be valued *Z89^Lab Results History^HL7nnnn*.

|QueryTag | |ST |Unique to each query message instance.

|SelectionCriteria | |ST |A query expression whose operands are derived from the 'ColName' column in the 'Input Specification: Virtual Table' given below.

|===

*Input Specification: Virtual Table*

[width="99%",cols="19%,9%,3%,6%,8%,3%,6%,8%,8%,10%,11%,9%",options="header",]

|===

|ColName (Query ID=Z89) a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|PatientList |*S* |*Y* |*20* |*CX* |*O* | | | |PID.3 | |PID-3: Patient Identifier List

|ResultReportTime.LL | | |26 |DTM |O | | | |OBR.22 | |OBR-22: Results rpt/status chng – date/time – lower limit

|ResultReportTime.UL | | |26 |DTM |O | | | |OBR.22 | |OBR-22: Results rpt/status chng – date/time – upper limit

|LabDept | | |80 |CWE |O |Y | |0074 |OBR.24 | |OBR-24: Diagnostic Serv Sect ID

|LOINCCode | | |80 |CWE |O |Y | | |OBX.3.4 | |OBX-3-4: Observation identifier – alternate identifier

|===

*Input Parameter Field Description and Commentary*

[width="100%",cols="19%,11%,6%,64%",options="header",]

|===

|Input Parameter (Query ID=Z89) |Comp. Name |DT |Description

|*PatientList* | |CX |The combination of values for _PatientList.ID, and PatientList.AssigningAuthority,_ are intended to identify a unique entry on the PATIENT_MASTER table. The _PatientList.IdentifierTypeCode_ is useful for further filtering or to supply uniqueness in the event that the assigning authority may have more than one coding system. (The PATIENT_MASTER table contains a constraint that prevents multiple patients from being identified by the same combination of field values.)

| | | |If this field is not valued, all values for this field are considered to be a match.

| | | |If one PID.3 is specified, only 1 segment pattern will be returned.

| |*ID* |ID |If this field, PID.3.1, is not valued, all values for this field are considered to be a match.

| |*Assigning Authority* |HD |If this field, PID.3.4, is not valued, all values for this field are considered to be a match.

| |*Identifier type code* |CWE |If this field, PID.3.5, is not valued, all values for this field are considered to be a match.

|*Result Report Time.LL* | |DTM |The earliest date and time for which results are to be returned. If this field is not valued, the earliest results that conform to the other query parameters will be returned.

|*Result Report Time.UL* | |DTM |The latest date and time for which results are to be returned. If this field is not valued, the latest results that conform to the other query parameters will be returned.

|*LabDept* | |CWE |The section(s) or department(s) of the laboratory reporting the results. As many *LabDept* values may be specified as desired. If this field is not valued, results that conform to the other query parameters from all sections or departments will be returned.

|*LOINCCode* | |CWE |The LOINC identifier for the results to be reported. As many *LOINCCode* values may be specified as desired. If this field is not valued, results that conform to the other query parameters for all LOINC codes will be returned.

|===

*RCP Response Control Parameter Field Description and Commentary*

[width="100%",cols="13%,26%,11%,6%,7%,37%",options="header",]

|===

|Field Seq (Query ID=Z89) |Name |Com­po­nent Name |LEN |DT |Description

|1 |Query Priority | |1 |ID |(*D*)eferred or (*I*)mmediate. Default is *I*.

|2 |Quantity Limited Request | |10 |CQ |

| | |Quantity | |NM |Number of units (specified by the following component) that will be returned in each increment of the response. If no value is given, the entire response will be returned in a single increment.

| | |Units | |CWE |**CH**aracters, **LI**nes, **P**a**G**es, or **R**ecor**D**s. Default is *LI*.

|3 |Response Modality | |60 |CWE |**R**eal time or **B**atch. Default is *R*.

|7 |Segment group inclusion | |256 |ID |What segment group(s) are to be included. If this field is not valued, all segment groups will be included.

|===

If a LOINC code is used as one of the operands of the input specification expression, all of the other OBX segments which are part of the same OBR as the selected OBX will be returned along with the selected OBX. In other words, if an OBX segment that is part of a panel is selected by the query, the entire panel will be returned.

==== Lab example different instantiation

The same Query Name might be invoked with a different query tag (456) as follows:

The user wishes to know all the lab results reported having a LOINC code of 6777-7 between March 21, 1999 and March 23, 1999.

MSH|^~\&|PCR|GenHosp|LIS||199907131040-0800||QBP^Z89^QBP_Z89|4495|D|2.8|

QPD|Z89^LabResultsHistory^HL7nnnn||@OBX.3.4^EQ^6777-7^AND|@OBR.22^GE^19990321^AND|@OBR.22^LE^19990323

RCP|I||R|

The second instance of the "Lab Results for Specified Criteria" query would clearly return quite different results than the first even though both are invocations of the same query.

=== Query by parameter (QBP) / tabular response (RTB)

==== MPI example

The user wishes to know the identity of the patient whose medical record number is "555444222111".

MSH|^~\&|PCR|GenHosp|MPI||199811201400-0800||QBP^Z91^QBP_Q13|8699|P|2.8||||||||

QPD|Z91^WhoAmI^HL7nnnn|Q0009|555444222111^^^MPI^MR

RCP|I|999^RD|

RDF|PatientList^CX^20~PatientName^XPN^48~Mother'sMaidenName^XPN^48~DOB^DTM^24~Sex^IS^1~Race^CWE^80|

The MPI system returns the following RTB message:

MSH|^~\&|MPI|GenHosp|PCR||199811201400-0800||RTB^Z92^RTB_K13|8699|P|2.8||||||||

MSA|AA|8699|

QAK|Q0009|OK|Z91^WhoAmI^HL7nnnn|1|

QPD|Z91^WhoAmI^HL7nnnn|Q0009|555444222111^^MPI^MR

RDF|PatientList^CX^20~PatientName^XPN^48~Mother'sMaidenName^XPN^48~DOB^DTM^24~Sex^IS^1~Race^CWE^80|

RDT|555444222111^^^MPI^MR|Everyman^Adam||19600614|M||

===== MPI Query Profile

Query Profile

[width="100%",cols="39%,61%",options="header",]

|===

|Query Statement ID (Query ID=Z89): |Z91

|Type: |Query

|Query Name: |Who Am I

|Query Trigger (= MSH-9): |QBP^Z91^QBP_Q13

|Query Mode: |Both

|Response Trigger (= MSH-9): |RTB^Z92^RTB_K13

|Query Characteristics: |

|Purpose: |Find the identity of the patient for specified medical record number(s)

|Response Characteristics: |

|Based on Segment Pattern: |

|===

The message structure for QBP^Z91^QPB_Q13 can be found in 5.3.1.2. Use the QBP^Q13^QPB_Q13 Message structure.

RTB^Z92^RTB_K13: Response Grammar: Who Am I

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec Ref

|MSH |Message Header | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|MSA |Message Acknowledgement | |2.15.8

|[ERR] |Error | |2.15.5

|link:#QAK[QAK] |Query Acknowledgement | |5.5.2

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|[ |--- ROW_DEFINITION begin | |

|link:#RDF[RDF] |Table Row Definition Segment | |5.5.7

|[\{ link:#RDT[RDT] }] |Table Row Data Segment | |5.5.8

|] |--- ROW_DEFINITION end | |

|[ DSC ] |Continuation Pointer | |2.15.4

|===

*QPD Input Parameter Specification*

[width="100%",cols="11%,14%,8%,3%,6%,8%,3%,3%,8%,8%,9%,8%,11%",options="header",]

|===

|Field Seq (Query ID=Z91) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|1 |MessageQueryName | | |60 |CWE |R | | | | | |

|2 |QueryTag | | |32 |ST |R | | | | | |

|3 |PatientList |*S* |*Y* |*20* |*CX* |*O* | | | |PID.3 | |PID-3: Patient Identifier List

|===

*QPD Input Parameter Field Description and Commentary*

[width="100%",cols="20%,11%,6%,63%",options="header",]

|===

|Input Parameter (Query ID=Z91) |Comp. Name |DT |Description

|MessageQueryName | |CWE |SHALL be valued *Z91^Who Am I^HL7nnnn*.

|QueryTag | |ST |Unique to each query message instance.

|PatientList | |CX |The combination of values for _PatientList.ID, and PatientList.AssigningAuthority,_ are intended to identify a unique entry on the PATIENT_MASTER table. The _PatientList.IdentifierTypeCode_ is useful for further filtering or to supply uniqueness in the event that the assigning authority may have more than one coding system. (The PATIENT_MASTER table contains a constraint that prevents multiple patients from being identified by the same combination of field values.) +

 +

If this field is not valued, all values for this field are considered to be a match. +

 +

If one PID.3 is specified, only 1 segment pattern will be returned.

| |ID |ID |If this field, PID.3.1, is not valued, all values for this field are considered to be a match.

| |Assigning Authority |HD |If this field, PID.3.4, is not valued, all values for this field are considered to be a match.

| |Identifier type code |CWE |If this field, PID.3.5, is not valued, all values for this field are considered to be a match.

|===

*RCP Response Control Parameter Field Description and Commentary*

[width="100%",cols="13%,25%,13%,6%,7%,36%",options="header",]

|===

|Field Seq (Query ID=Z91) |Name |Com­po­nent Name |LEN |DT |Description

|1 |Query Priority | |1 |ID |(*D*)eferred or (*I*)mmediate. Default is *I*.

|2 |Quantity Limited Request | |10 |CQ |

| | |Quantity | |NM |Number of units (specified by the following component) that will be returned in each increment of the response. If no value is given, the entire response will be returned in a single increment.

| | |Units | |CWE |**CH**aracters, **LI**nes, **P**a**G**es, or **R**ecor**D**s. Default is *LI*.

|3 |Response Modality | |60 |CWE |**R**eal time or **B**atch. Default is *R*.

|6 |Sort-by Field | |256 |SRT |

| | |Sort-by Field | |ST |Segment field name of an output column by which the response may be sorted. SHALL contain a *Y* in the Sort column of the output specification table.

| | |Sequencing | |ID |As specified in HL7 Table 0397- Sequencing. Default is **A**scending.

|===

*Output Specification and Commentary: Virtual Table*

[width="99%",cols="19%,9%,3%,6%,8%,3%,6%,8%,8%,10%,11%,9%",options="header",]

|===

|ColName (Query ID=Z91) a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|PatientList |*S* |*Y* |*20* |*CX* |*O* | | | |PID.3 | |PID-3 Patient Identifier List

|PatientName | | |48 |XPN | | | | |PID.5 | |PID-5 Patient Name

|Mother'sMaidenName | | |48 |XPN | | | | |PID.6 | |PID-6 Mother's Maiden Name

|DOB | | |24 |DTM | | | | |PID.7 | |PID-7 Date/Time of Birth

|Sex | | |1 |CWE | | | | |PID.8 | |PID-8 Sex

|Race | | |80 |CWE | | | | |PID.10 | |PID-10 Race

|===

==== Pharmacy example:

The user wishes to know all the medications dispensed for the patient whose medical record number is "555444222111" for the period beginning 5/31/98 and ending 5/31/99. The following QBP message is generated:

MSH|^~\&|PCR|Gen Hosp|PIMS||199811201400-0800||QBP^Q42^QBP_Q13|8699|P|2.8||||||||

QPD|Q42^Tabular Dispense History^HL7nnn|Q0010|555444222111^^^MPI^MR| |19980531|19990531|

RDF|3|PatientList^ST^20~PatientName^XPN^48~MedicationDispensed^ST^40~RXD.3^DTM^24

RCP|I|999^RD|

The pharmacy system identifies medical record number "555444222111" as belonging to Adam Everyman and locates 4 prescription dispenses meeting the criteria and returns the following RTB message:

MSH|^~\&|PIMS|Gen Hosp|PCR||199811201400-0800||RTB^K42^RTB_K13|8858|P|2.8||||||||

MSA|AA|8699|

QAK|Q010|OK|Q42^Tabular Dispense History^HL7nnn|4

QPD|Q42^Tabular Dispense History^HL7nnn|Q0010|555444222111^^^MPI^MR||19980531|19990531|

RDF|7|PatientId^CX^20~PatientName^XPN^48~OrderControlCode^ID^2~ MedicationDispensed^CWE^100~DispenseDate^DTM^24~QuantityDispensed^NM^20~ OrderingProvider^XCN^120

RDT|555444222111^^^MPI^MR|Everyman^Adam|RE|525440345^Verapamil Hydrochloride 120 mg TAB^NDC |199805291115-0700|100|77^Hippocrates^Harold^H^III^DR^MD

RDT|555444222111^^^MPI^MR|Everyman^Adam|RE|00182196901^VERAPAMIL HCL ER TAB 180MG ER^NDC |19980821-0700|100|77^Hippocrates^Harold^H^III^DR^MD

RDT|555444222111^^^MPI^MR|Everyman^Adam|RE|00172409660^BACLOFEN 10MG TABS^NDC |199809221415-0700|10|88^Seven^Henry^^^DR^MD

RDT|555444222111^^^MPI^MR|Everyman^Adam|RE|00054384163^THEOPHYLLINE 80MG/15ML SOLN^NDC|199810121145-0700|10|99^Assigned^Amanda^^^DR^MD

===== QBP/RTB dispense history Query Profile

Query Profile

[width="100%",cols="39%,61%",options="header",]

|===

|Query Statement ID (Query ID=Z89): |Z93

|Type: |Query

|Query Name: |Tabular Dispense History

|Query Trigger (= MSH-9): |QBP^Z93^QBP_Q13

|Query Mode: |Both

|Response Trigger (= MSH-9): |RTB^Z94^RTB_K13

|Query Characteristics: |Returns response sorted by Date Dispensed unless otherwise specified.

|Purpose: |Find medications dispensed between specified date range for specified medical record numbers.

|Response Characteristics: |

|Based on Segment Pattern: |

|===

The message structure for QBP^Z93^QPB_Q13 can be found in 5.3.1.2. Use the QBP^Q13^QPB_Q13 Message structure.

RTB^Z94^RTB_K13: Response Grammar: Who Am I

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec Ref

|MSH |Message Header | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|MSA |Message Acknowledgement | |2.15.8

|[ERR] |Error | |2.15.5

|link:#QAK[QAK] |Query Acknowledgement | |5.5.2

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|[ |--- ROW_DEFINITION begin | |

|link:#RDF[RDF] |Table Row Definition Segment | |5.5.7

|[\{ link:#RDT[RDT] }] |Table Row Data Segment | |5.5.8

|] |--- ROW_DEFINITION end | |

|[ DSC ] |Continuation Pointer | |2.15.4

|===

*QPD Input Parameter Specification*

[width="100%",cols="11%,14%,8%,3%,6%,8%,3%,3%,8%,8%,9%,8%,11%",options="header",]

|===

|Field Seq (Query ID=Z93) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|1 |MessageQueryName | | |60 |CWE |R | | | | | |

|2 |QueryTag | | |32 |ST |R | | | | | |

|3 |PatientList |*S* |*Y* |*20* |*CX* |*O* | | | |PID.3 | |PID-3: Patient Identifier List

|4 |MedicationDispensed |S |Y |100 |CWE |O | |= | |RXD.2 | |RXD-2: Dispense/Give Code

|5 |DispenseDate.LL |S |Y |24 |DTM |O | |> +

= | |RXD.3 | |RXD-3: Date/Time Dispensed

|6 |DispenseDate.UL |S |Y |24 |DTM |O | |< +

= | |RXD.3 | |RXD-3: Date/Time Dispensed

|===

*QPD Input Parameter Field Description and Commentary*

[width="100%",cols="20%,11%,6%,63%",options="header",]

|===

|Input Parameter (Query ID=Z93) |Comp. Name |DT |Description

|MessageQueryName | |CWE |SHALL be valued *Z93^Tabular Dispense History^HL7nnnn*.

|QueryTag | |ST |Unique to each query message instance.

|PatientList | |CX |The combination of values for _PatientList.ID, and PatientList.AssigningAuthority,_ are intended to identify a unique entry on the PATIENT_MASTER table. The _PatientList.IdentifierTypeCode_ is useful for further filtering or to supply uniqueness in the event that the assigning authority may have more than one coding system. (The PATIENT_MASTER table contains a constraint that prevents multiple patients from being identified by the same combination of field values.) This PATIENT_MASTER entry will be searched against on the PHARMACY_DISPENSE_TRANSACTION table to retrieve the rows fulfilling the query conditions.

| | | |If this field is not valued, all values for this field are considered to be a match.

| | | |If one PID.3 is specified, only 1 segment pattern will be returned.

| |ID |ID |If this field, PID.3.1, is not valued, all values for this field are considered to be a match.

| |Assigning Authority |HD |If this field, PID.3.4, is not valued, all values for this field are considered to be a match.

| |Identifier type code |CWE |If this field, PID.3.5, is not valued, all values for this field are considered to be a match.

|MedicationDispensed | |CWE |If this field is not valued, all values for this field are considered to be a match.

|DispenseDate.LL | |DTM |This is the earliest value to be returned for Date/Time Dispensed. If this field is not valued, all values for this field are considered to be a match.

|DispenseDate.UL | |DTM |This is the latest value to be returned for Date/Time Dispensed. If this field is not valued, all values for this field are considered to be a match.

|===

*RCP Response Control Parameter Field Description and Commentary*

[width="100%",cols="13%,25%,13%,6%,7%,36%",options="header",]

|===

|Field Seq (Query ID=Z93) |Name |Com­po­nent Name |LEN |DT |Description

|1 |Query Priority | |1 |ID |(*D*)eferred or (*I*)mmediate. Default is *I*.

|2 |Quantity Limited Request | |10 |CQ |

| | |Quantity | |NM |Number of units (specified by the following component) that will be returned in each increment of the response. If no value is given, the entire response will be returned in a single increment.

| | |Units | |CWE |**CH**aracters, **LI**nes, **P**a**G**es, or **R**ecor**D**s. Default is *LI*.

|3 |Response Modality | |60 |CWE |**R**eal time or **B**atch. Default is *R*.

|6 |Sort-by Field | |256 |SRT |

| | |Sort-by Field | |ST |Segment field name of an output column by which the response may be sorted. SHALL contain a *Y* in the Sort column of the output specification table.

| | |Sequencing | |ID |As specified in HL7 Table 0397- Sequencing. Default is **A**scending.

|===

*Output Specification and Commentary: Virtual Table*

[width="99%",cols="19%,9%,3%,6%,8%,3%,6%,8%,8%,10%,11%,9%",options="header",]

|===

|ColName (Query ID=Z93) a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|PatientList |*S* |*Y* |*20* |*CX* |*O* | | | |PID.3 | |PID-3 Patient Identifier List

|PatientName | | |48 |XPN | | | | |PID.5 | |PID-5 Patient Name

|MedicationDispensed |S |Y |100 |CWE |O | |= | |RXD.2 | |RXD-2 Dispense/Give Code

|DispenseDate.LL |S |Y |24 |DTM |O | |>= | |RXD.3 | |RXD-3 Date/Time Dispensed

|DispenseDate.UL |S |Y |24 |DTM |O | |<= | |RXD.3 | |RXD-3 Date/Time Dispensed

|===

=== Query using QSC variant / tabular response (RTB)

==== Pharmacy example

The user wishes to know all the medications dispensed for the patient whose medical record number is "555444222111" for the period beginning 5/31/98 and ending 5/31/99. The following message is generated:

MSH|^~\&|PCR|Gen Hosp|PIMS||199811201400-0800||QBP^Z95^QBP_Q13|8699|P|2.8||||||||

QPD|Z95^Dispense Information^HL7nnnn|Q504 |PID.3^EQ^55544422211^AND~RXD.3^GE^19980531^AND~RXD.3^LE^19990531

RDF|3|PatientList^ST^20|PatientName^XPN^48|OrderControlCode^ID^2|OrderingProvider^XCN^120|MedicationDispensed^ST^40|DispenseDate^DTM^24|QuantityDispensed^NM^20|

RCP|I|999^RD|

The pharmacy system identifies medical record number "555444222111" as belonging to Adam Everyman and locates 4 prescription dispenses meeting the criteria and returns the following RTB message:

MSH|^~\&|PIMS|Gen Hosp|PCR||199811201400-0800||RTB^Z96^RTB_K13|8858|P|2.8||||||||

MSA|AA|8699|

QAK|Q001|OK|Z95^Dispense Information^HL7nnnn|4

QPD|Z95^Dispense Information^HL7nnnn|Q504 |PID.3^EQ^55544422211^AND~RXD.3^GE^19980531^AND~RXD.3^LE^19990531

RDF|3|PatientList^ST^20~PatientName^XPN^48~OrderControlCode^ID^2~OrderingProvider^XCN^120~MedicationDispensed^ST^40~DispenseDate^DTM^24~QuantityDispensed^NM^20|

RDT|555444222111^^^MPI^MR|Everyman^Adam|RE|77^Hippocrates^Harold^H^III^DR^MD |525440345^Verapamil Hydrochloride 120 mg TAB^NDC |199805291115-0700|100

RDT|555444222111^^^MPI^MR|Everyman^Adam|RE|77^Hippocrates^Harold^H^III^DR^MD |00182196901^VERAPAMIL HCL ER TAB 180MG ER^NDC |19980821-0700|100

RDT|555444222111^^^MPI^MR|Everyman^Adam|RE|88^Seven^Henry^^^DR^MD |00172409660^BACLOFEN 10MG TABS^NDC |199809221415-0700|10

RDT|555444222111^^^MPI^MR|Everyman^Adam|RE|99^Assigned^Amanda^^^DR^MD |00054384163^THEOPHYLLINE 80MG/15ML SOLN^NDC|199810121145-0700|10

===== QBP/RTB dispense history Query Profile using QSC variant

Note that this Query Profile includes no separate Output Description and Commentary. In the QBP/RTB combination using the QSC variant, the selection criteria in _QPD-3-user parameters_ and the desired return data in _RDF-2-column description_ are constructed from the same Virtual Table, which appears in the Input Specification.

Query Profile

[width="100%",cols="39%,61%",options="header",]

|===

|Query Statement ID (Query ID=Z95): |Z95

|Type: |Query

|Query Name: |Tabular Dispense History

|Query Trigger (= MSH-9): |QBP^Z95^QBP_Q13

|Query Mode: |Both

|Response Trigger (= MSH-9): |RTB^Z96^RTB_K13

|Query Characteristics: |Selection criteria are chosen from a Virtual Table. May specify patient, medication, and a date range.

|Purpose: |To retrieve patient pharmacy dispense history information from the Server.

|Response Characteristics: a|

Columns from the *Virtual Table* listed in the Input/Output Specification are specified for output in the RDF segment.

*If no columns are specified in the RDF segment, all columns will be returned.*

Response is sorted by Medication Dispensed unless otherwise specified in *SortControl.*

|Based on Segment Pattern: |

|===

The message structure for QBP^Z95^QPB_Q13 can be found in 5.3.1.2. Use the QBP^Q13^QPB_Q13 Message structure.

RTB^Z96^RTB_K13: Response Grammar: Who Am I

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec Ref

|MSH |Message Header | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|MSA |Message Acknowledgement | |2.15.8

|[ERR] |Error | |2.15.5

|link:#QAK[QAK] |Query Acknowledgement | |5.5.2

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|[ |--- ROW_DEFINITION begin | |

|link:#RDF[RDF] |Table Row Definition Segment | |5.5.7

|[\{ link:#RDT[RDT] }] |Table Row Data Segment | |5.5.8

|] |--- ROW_DEFINITION end | |

|[ DSC ] |Continuation Pointer | |2.15.4

|===

*QPD Input Parameter Specification*

[width="100%",cols="11%,14%,8%,3%,6%,8%,3%,3%,8%,8%,9%,8%,11%",options="header",]

|===

|Field Seq (Query ID=Z95) |Field Description a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|1 |MessageQueryName | | |60 |CWE |R | | | | | |

|2 |QueryTag | | |32 |ST |R | | | | | |

|3 |SelectionCriteria | | |*255* |*ST* |*R* |*Y* | | | | |

|===

*QPD Input Parameter Field Description and Commentary*

[width="100%",cols="20%,11%,6%,63%",options="header",]

|===

|Input Parameter (Query ID=Z95) |Comp. Name |DT |Description

|MessageQueryName | |CWE |SHALL be valued *Z95^Tabular Dispense History^HL7nnnn*.

|QueryTag | |ST |Unique to each query message instance.

|SelectionCriteria | |ST |A query expression whose operands are derived from the 'ColName' column in the 'Input/Output Specification: Virtual Table' given below.

|===

*Input/Output Specification: Virtual Table*

[width="99%",cols="19%,9%,3%,6%,8%,3%,6%,8%,8%,10%,11%,9%",options="header",]

|===

|ColName (Query ID=Z95) a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|PatientList |S |Y |20 |CX |O | | | |PID.3 | |PID-3 Patient Identifier List

|PatientName | | |48 |XPN | | | | |PID.5 | |PID-5 Patient Name

|OrderControlCode |S | |2 |ID | | | |0119 |ORC.1 | |ORC-1 Order Control

|MedicationDispensed |S |Y |100 |CWE | | | | |RXD.2 | |RXD-2 Dispense/Give Code

|DispenseDate |S | |24 |DTM | | | | |RXD.3 | |RXD-2 Date/Time Dispensed

|QuantityDispensed |L | |20 |NM | | | | |RXD.4 | |RXD-4 Actual Dispense Amount

|OrderingProvider |S | |120 |XCN | | | | |ORC.12 | |ORC-12 Ordering Provider

|===

*Virtual Table Field Description and Commentary*

[width="100%",cols="22%,10%,6%,62%",options="header",]

|===

|ColName (Query ID=Z95) |Comp. Name |DT |Description

|*PatientList* | |CX |The combination of values for _PatientList.ID, and PatientList.AssigningAuthority,_ are intended to identify a unique entry on the PATIENT_MASTER table. The _PatientList.IdentifierTypeCode_ is useful for further filtering or to supply uniqueness in the event that the assigning authority may have more than one coding system. (The PATIENT_MASTER table contains a constraint that prevents multiple patients from being identified by the same combination of field values.) This PATIENT_MASTER entry will be searched against on the PHARMACY_DISPENSE_TRANSACTION table to retrieve the rows fulfilling the query conditions.

| | | |If this field is not valued, all values for this field are considered to be a match.

| | | |If one PID.3 is specified, only 1 segment pattern will be returned.

| |*ID* |ID |If this field, PID.3.1, is not valued, all values for this field are considered to be a match.

| |*Assigning Authority* |HD |If this field, PID.3.4, is not valued, all values for this field are considered to be a match.

| |*Identifier type code* |CWE |If this field, PID.3.5, is not valued, all values for this field are considered to be a match.

|*PatientName* | |XPN |If this field, PID.5, is not valued, all values for this field are considered to be a match.

|*OrderControlCode* | |ID |If this field, ORC.1, is not valued, all values for this field are considered to be a match.

|*MedicationDispensed* | |CWE |If this field, RXD.2, is not valued, all values for this field are considered to be a match.

|*DispenseDate* | |DTM |If this field, RXD.3, is not valued, all values for this field are considered to be a match.

|*QuantityDispensed* | |NM |If this field, RXD.4, is not valued, all values for this field are considered to be a match.

|*OrderingProvider* | |XCN |If this field, ORC.12, is not valued, all values for this field are considered to be a match.

|===

*RCP Response Control Parameter Field Description and Commentary*

[width="100%",cols="13%,25%,14%,7%,7%,34%",options="header",]

|===

|Field Seq (Query ID=Z95) |Name |Com­po­nent Name |LEN |DT |Description

|1 |Query Priority | |1 |ID |(*D*)eferred or (*I*)mmediate. Default is *I*.

|2 |Quantity Limited Request | |10 |CQ |

| | |Quantity | |NM |Number of units (specified by the following component) that will be returned in each increment of the response. If no value is given, the entire response will be returned in a single increment.

| | |Units | |CWE |**CH**aracters, **LI**nes, **P**a**G**es, or **R**ecor**D**s. Default is *LI*.

|3 |Response Modality | |60 |CWE |**R**eal time or **B**atch. Default is *R*.

|6 |Sort-by Field | |256 |SRT |

| | |Sort-by Field | |ST |Segment field name of an output column by which the response may be sorted. SHALL contain a *Y* in the Sort column of the output specification table.

| | |Sequencing | |ID |As specified in HL7 Table 0397- Sequencing. Default is **A**scending.

|===

=== Query by parameter (QBP) / display response (RDY)

The user wishes to know all the medications dispensed for the patient whose medical record number is "555444222111" for the period beginning 5/31/98 and ending 5/31/99. The following QBP message is generated.

MSH|^~\&|PCR|Gen Hosp|PIMS||199909171400-0800||QBP^Z97^QBP_Q15|8699|P|2.8||||||||

QPD|Z97^DispenseHistoryDisplay^HL7nnnn|Q005|555444222111^^^MPI^MR||19980531|19990531|

RCP|I|999^RD|

The pharmacy system identifies medical record number "555444222111" as belonging to Adam Everyman and locates 4 prescription dispenses meeting the criteria and returns the following RDY message:

MSH|^~\&|PIMS|Gen Hosp|PCR||199909171401-0800||RDY^Z98^RDY_K15|8858|P|2.8||||||||

MSA|AA|8699|

QAK|Q005|OK|Z97^DispenseHistoryDisplay|4

QPD|Z97^DispenseHistoryDisplay^HL7nnnn|Q005|555444222111^^^MPI^MR||19980531|19990531|

DSP||| GENERAL HOSPITAL – PHARMACY DEPARTMENT DATE:09-17-99

DSP||| DISPENSE HISTORY REPORT PAGE 1

DSP|||MRN Patient Name MEDICATION DISPENSED DISP-DATE

DSP|||555444222111 Everyman,Adam VERAPAMIL HCL 120 mg TAB 05/29/1998

DSP|||555444222111 Everyman,Adam VERAPAMIL HCL ER TAB 180MG 08/21/1998

DSP|||555444222111 Everyman,Adam BACLOFEN 10MG TABS 09/22/1998

DSP|||555444222111 Everyman,Adam THEOPHYLLINE 80MG/15ML SOL 10/12/1998

DSP||| << END OF REPORT >>

==== Dispense history display Query Profile

Note that this Query Profile includes no separate Output Description and Commentary. In Query Profiles that specify an RDY response message, the display format follows the response grammar.

Query Profile

[width="100%",cols="39%,61%",options="header",]

|===

|Query Statement ID (Query ID=Z97): |Z97

|Type: |Query

|Query Name: |Dispense History

|Query Trigger (= MSH-9): |QBP^Z97^QBP_Q15

|Query Mode: |Both

|Response Trigger (= MSH-9): |RDY^Z98^RDY_K15

|Query Characteristics: |May specify patient, medication, a date range, and how the response is to be sorted.

|Purpose: |To retrieve patient pharmacy dispense history information from the Server.

|Response Characteristics: |Returns data formatted for screen display. Data are sorted by Medication Dispensed unless otherwise specified in *SortControl.*

|Based on Segment Pattern: |

|===

The message structure for QBP^Z97^QPB_Q15 can be found in 5.4.3. Use the QBP^Q15^QPB_Q15 Message structure.

RDY^Z98^RDY_K15: Response Grammar: Dispense History

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec Ref

|MSH |Message Header | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|MSA |Message Acknowledgement | |2.15.8

|[ERR] |Error | |2.15.5

|link:#QAK[QAK] |Query Acknowledgement | |5.5.2

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|[\{ link:#DSP[DSP] }] |Display Data | |5.5.1

|[ DSC ] |Continuation Pointer | |2.15.4

|===

[width="100%",cols="100%",options="header",]

|===

|The data will display as follows: (Query ID=Z97)

|DSP\|\|\| GENERAL HOSPITAL – PHARMACY DEPARTMENT DATE:mm-dd-yy

|DSP\|\|\| DISPENSE HISTORY REPORT PAGE n

|DSP\|\|\|MRN Patient Name MEDICATION DISPENSED DISP-DATE

|DSP\|\|\|XXXXX XXXXXx, XXXXX XXXXXXXXXXXXXXXX mm/dd/ccyy

|...

|DSP\|\|\| << END OF REPORT >>

|===

*QPD Input Parameter Specification*

[width="100%",cols="11%,14%,8%,3%,6%,8%,3%,3%,8%,8%,9%,8%,11%",options="header",]

|===

|Field Seq (Query ID=Z97) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|1 |MessageQueryName | | |60 |CWE |R | | | | | |

|2 |QueryTag | | |32 |ST |R | | | | | |

|3 |PatientList |S |Y |20 |CX |O | | | |PID.3 | |PID-3: Patient Identifier List

|4 |MedicationDispensed |S |Y |100 |CWE |O | |= | |RXD.2 | |RXD-2: Dispense/Give Code

|5 |DispenseDate.LL |S |Y |24 |DTM |O | |> +

= | |RXD.3 | |RXD-3: Date/Time Dispensed

|6 |DispenseDate.UL |S |Y |24 |DTM |O | |< +

= | |RXD.3 | |RXD-3: Date/Time Dispensed

|===

*QPD Input Parameter Field Description and Commentary*

[width="100%",cols="22%,10%,6%,62%",options="header",]

|===

|Input Parameter (Query ID=Z97) |Comp. Name |DT |Description

|*MessageQueryName* | |CWE |SHALL be valued *Z97^Dispense History^HL7nnnn*.

|*QueryTag* | |ST |Unique to each query message instance.

|*PatientList* | |CX |The combination of values for _PatientList.ID, and PatientList.AssigningAuthority,_ are intended to identify a unique entry on the PATIENT_MASTER table. The _PatientList.IdentifierTypeCode_ is useful for further filtering or to supply uniqueness in the event that the assigning authority may have more than one coding system. (The PATIENT_MASTER table contains a constraint that prevents multiple patients from being identified by the same combination of field values.) This PATIENT_MASTER entry will be searched against on the PHARMACY_DISPENSE_TRANSACTION table to retrieve the rows fulfilling the query conditions.

| | | |If this field is not valued, all values for this field are considered to be a match.

| | | |If one PID.3 is specified, only 1 segment pattern will be returned.

| |*ID* |ID |If this field, PID.3.1, is not valued, all values for this field are considered to be a match.

| |*Assigning Authority* |HD |If this field, PID.3.4, is not valued, all values for this field are considered to be a match.

| |*Identifier type code* |CWE |If this field, PID.3.5, is not valued, all values for this field are considered to be a match.

|*MedicationDispensed* | |CWE |If this field is not valued, all values for this field are considered to be a match.

|*DispenseDate.LL* | |DTM |This is the earliest value to be returned for Date/Time Dispensed. If this field is not valued, all values for this field are considered to be a match.

|*DispenseDate.UL* | |DTM |This is the latest value to be returned for Date/Time Dispensed. If this field is not valued, all values for this field are considered to be a match.

|===

*RCP Response Control Parameter Field Description and Commentary*

[width="100%",cols="13%,26%,11%,6%,7%,37%",options="header",]

|===

|Field Seq (Query ID=Z97) |Name |Com­po­nent Name |LEN |DT |Description

|1 |Query Priority | |1 |ID |(*D*)eferred or (*I*)mmediate. Default is *I*.

|2 |Quantity Limited Request | |10 |CQ |

| | |Quantity | |NM |Number of units (specified by the following component) that will be returned in each increment of the response. If no value is given, the entire response will be returned in a single increment.

| | |Units | |CWE |**CH**aracters, **LI**nes, **P**a**G**es, or **R**ecor**D**s. Default is *LI*.

|3 |Response Modality | |60 |CWE |**R**eal time or **B**atch. Default is *R*.

|===

=== Query using QSC variant (QBP) / display response (RDY)

The user wishes to know all the medications ever dispensed for the patient whose medical record number is "555444222111" prescribed by Dr Lister (provider number 99). The following message is generated. (Note the similarity between the QPD segment here and that used in the query in Section 5.8.4.)

MSH|^~\&|PCR|Gen Hosp|PIMS||199811201300-0800||QBP^Z79^QBP_Q15|8698|P|2.8||||||||

QPD|Z79^Dispense Information^HL7nnnn|Q503 |PID.3^EQ^55544422211^AND|ORC.1^EQ^RE^AND|ORC.12.1^EQ^99

RCP|I|999^RD|

The pharmacy system identifies medical record number "555444222111" as belonging to Adam Everyman and locates 2 prescription dispenses as prescribed by Dr. Lister. The response is clearly different than the response to the first query.

MSH|^~\&|PIMS|Gen Hosp|PCR||199811201300-0800||RDY^Z80^RDY_K15|8857|P|2.8||||||||

MSA|AA|8698|

QAK|Q003|OK|Z79^Dispense Information^HL7nnnn|2

QPD|Z79^Dispense Information^HL7nnnn|Q503 |@PID.3^EQ^55544422211^AND~ORC.1^EQ^RE^AND~@RXD.3^GE^199711200000-0800^AND~@RXD.3^LE^199811200000-0800

DSP||| GENERAL HOSPITAL – PHARMACY DEPARTMENT DATE:09-17-99

DSP||| DISPENSE HISTORY REPORT PAGE 1

DSP|||MRN Patient Name MEDICATION DISPENSED DISP-DATE

DSP|||555444222111 Everyman,Adam VERAPAMIL HCL 120 mg TAB 05/29/1998

DSP|||555444222111 Everyman,Adam THEOPHYLLINE 80MG/15ML SOL 10/12/1998

DSP||| << END OF REPORT >>

==== Dispense history display Query Profile using QSC variant

Note that this Query Profile includes no separate Output Description and Commentary. In Query Profiles that specify an RDY response message, the display format follows the response grammar.

Query Profile

[width="100%",cols="39%,61%",options="header",]

|===

|Query Statement ID (Query ID=Z79): |Z79

|Type: |Query

|Query Name: |Dispense Information

|Query Trigger (= MSH-9): |QBP^Z79^QBP_Q15

|Query Mode: |Both

|Response Trigger (= MSH-9): |RDY^Z80^RDY_Z80

|Query Characteristics: |Selection criteria are chosen from a Virtual Table. May specify patient, order control code, medication, a date range, quantity dispensed, and ordering provider.

|Purpose: |To retrieve patient pharmacy dispense history information from the Server.

|Response Characteristics: |Returns data formatted for screen display. Data are sorted by Medication Dispensed unless otherwise specified in *SortControl.*

|Based on Segment Pattern: |

|===

The QBP_Q15 and RDY_K15 message structures and related choreography can be found in link:#qbprdy-query-by-parameterdisplay-response-events-vary[5.4.3].

RDY^Z80^RDY_Z80: Response Grammar: Dispense History

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec Ref

|MSH |Message Header | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|MSA |Message Acknowledgement | |2.15.8

|[ERR] |Error | |2.15.5

|link:#QAK[QAK] |Query Acknowledgement | |5.5.2

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|[\{ link:#DSP[DSP] }] |Display Data | |5.5.1

|[ DSC ] |Continuation Pointer | |2.15.4

|===

[width="100%",cols="100%",options="header",]

|===

|The data will display as follows: (Query ID=Z79)

|DSP\|\|\| GENERAL HOSPITAL – PHARMACY DEPARTMENT DATE:mm-dd-yy

|DSP\|\|\| DISPENSE HISTORY REPORT PAGE n

|DSP\|\|\|MRN Patient Name MEDICATION DISPENSED DISP-DATE

|DSP\|\|\|XXXXX XXXXXx, XXXXX XXXXXXXXXXXXXXXX mm/dd/ccyy

|...

|DSP\|\|\| << END OF REPORT >>

|===

*QPD Input Parameter Specification*

[width="100%",cols="11%,14%,8%,3%,6%,8%,3%,3%,8%,8%,9%,8%,11%",options="header",]

|===

|Field Seq (Query ID=Z79) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |ElementName

|1 |MessageQueryName | | |60 |CWE |R | | | | | |

|2 |QueryTag | | |32 |ST |R | | | | | |

|3 |SelectionCriteria | | |*255* |*ST* |*R* |*Y* | | | | |

|===

*QPD Input Parameter Field Description and Commentary*

[width="100%",cols="20%,11%,6%,63%",options="header",]

|===

|Input Parameter (Query ID=Z79) |Comp. Name |DT |Description

|MessageQueryName | |CWE |SHALL be valued *Z79^Dispense Information^HL7nnnn*.

|QueryTag | |ST |Unique to each query message instance.

|SelectionCriteria | |ST |A query expression whose operands are derived from the 'ColName' column in the 'Input/Output Specification: Virtual Table' given below.

|===

*Input Specification: Virtual Table*

[width="99%",cols="19%,9%,3%,6%,8%,3%,6%,8%,8%,10%,11%,9%",options="header",]

|===

|ColName (Query ID=Z79) a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |ElementName

|PatientList |S |Y |20 |CX |O | | | |PID.3 | |PID-3: Patient Identifier List

|OrderControlCode |S | |2 |ID | | | |0119 |ORC.1 | |ORC-1 Order Control

|MedicationDispensed |S |Y |100 |CWE | | | | |RXD.2 | |RXD-2 Dispense/Give Code

|DispenseDate |S | |24 |DTM | | | | |RXD.3 | |RXD-2 Date/Time Dispensed

|QuantityDispensed |L | |20 |NM | | | | |RXD.4 | |RXD-4 Actual Dispense Amount

|OrderingProvider |S | |120 |XCN | | | | |ORC.12 | |ORC-12 Ordering Provider

|===

*Virtual Table Field Description and Commentary*

[width="100%",cols="22%,11%,6%,61%",options="header",]

|===

|ColName (Query ID=Z79) |Comp. Name |DT |Description

|*PatientList* | |CX |The combination of values for _PatientList.ID, and PatientList.AssigningAuthority,_ are intended to identify a unique entry on the PATIENT_MASTER table. The _PatientList.IdentifierTypeCode_ is useful for further filtering or to supply uniqueness in the event that the assigning authority may have more than one coding system. (The PATIENT_MASTER table contains a constraint that prevents multiple patients from being identified by the same combination of field values.) This PATIENT_MASTER entry will be searched against on the PHARMACY_DISPENSE_TRANSACTION table to retrieve the rows fulfilling the query conditions.

| | | |If this field is not valued, all values for this field are considered to be a match.

| | | |If one PID.3 is specified, only 1 segment pattern will be returned.

| |*ID* |ID |If this field, PID.3.1, is not valued, all values for this field are considered to be a match.

| |*Assigning Authority* |HD |If this field, PID.3.4, is not valued, all values for this field are considered to be a match.

| |*Identifier type code* |CWE |If this field, PID.3.5, is not valued, all values for this field are considered to be a match.

|*OrderControlCode* | |ID |If this field, ORC.1, is not valued, all values for this field are considered to be a match.

|*MedicationDispensed* | |CWE |If this field, RXD.2, is not valued, all values for this field are considered to be a match.

|*DispenseDate* | |DTM |If this field, RXD.3, is not valued, all values for this field are considered to be a match.

|*QuantityDispensed* | |NM |If this field, RXD.4, is not valued, all values for this field are considered to be a match.

|*OrderingProvider* | |XCN |If this field, ORC.12, is not valued, all values for this field are considered to be a match.

|===

*RCP Response Control Parameter Field Description and Commentary*

[width="100%",cols="13%,25%,14%,7%,7%,34%",options="header",]

|===

|Field Seq (Query ID=Z79) |Name |Com­po­nent Name |LEN |DT |Description

|1 |Query Priority | |1 |ID |(*D*)eferred or (*I*)mmediate. Default is *I*.

|2 |Quantity Limited Request | |10 |CQ |

| | |Quantity | |NM |Number of units (specified by the following component) that will be returned in each increment of the response. If no value is given, the entire response will be returned in a single increment.

| | |Units | |CWE |**CH**aracters, **LI**nes, **P**a**G**es, or **R**ecor**D**s. Default is *LI*.

|3 |Response Modality | |60 |CWE |**R**eal time or **B**atch. Default is *R*.

|6 |Sort-by Field | |256 |SRT |

| | |Sort-by Field | |ST |Segment field name of an output column by which the response may be sorted. SHALL contain a *Y* in the Sort column of the output specification table.

| | |Sequencing | |ID |As specified in HL7 Table 0397- Sequencing. Default is **A**scending.

|===

=== +

Query by example (QBP) / tabular response (RTB)

This section demonstrates how to use a different syntax for passing query parameters to the query server. This syntactic variant is called "query by example" because, instead of passing query parameter as fields of the QBP segment, they are passed as fields of existing HL7 segments. Nevertheless, the Query Profile will clearly specify which fields of the HL7 segment can carry useful values. Note that both the QBP syntax and the "query by example" syntax have the same expressive power. Also note that when segments are used in the "query by example" variant, the required/optional characteristics of each field should be defined in the Query Profile, and that field optionality in queries may be different from the usual optionality of the segment when used in other HL7 messages.

This sample shows how the "query by example" might be used to find a list of candidates matching a set of demographics. Because demographic data is naturally carried by the existing PID segment, the message designer may, for stylistic or practical reasons, decide to pass the demographic parameters such as patient name or patient age in a PID segment.

The Client wishes to see a list of patients whose demographics are as follows:

Last Name: Nuclear +

First Name: Ned +

Sex: Male +

DOB: 12/11/48

The Client wishes to do this using the peekaboo algorithm with an 80% confidence level.

MSH|^~\&|PCR|GenHosp|MPI||199811201400-0800||QBP^Z77^QBP_Q13|8699|P|2.8||||||||

QPD|Z77^find_candidates^HL7nnnn|Q0001|peekaboo|80|

PID|||||Nuclear&Ned||19481211|M

RCP|I|25^RD|

RDF|PatientList^CX^20~PatientName^XPN^48~Mother'sMaidenName^XPN^48~DOB^DTM^24~Sex^IS^1~Race^CWE^80|

The MPI system returns the following RTB message

**MSH**|^~\&|MPI|GenHosp|PCR||199811201400-0800||RTB^Z78^RTB_R13|8699|P|2.8||||||||

**MSA**|AA|8699|

**QAK**|

**QPD**|Z77^find_candidates^HL7nnnn|Q0001|peekaboo|80|

**RDF**|PatientList^CX^20~PatientName^XPN^48~Mother'sMaidenName^XPN^48~DOB^DTM^24~Sex^IS^1~Race^CWE^80|

**RDT**|555444222111^^^MPI&KP.NCA&L^MR|Nuclear^Ned||19481211|M||

==== MPI Query Profile using QBE variant

Query Profile

[width="100%",cols="39%,61%",options="header",]

|===

|Query Statement ID (Query ID=Z77): |Z77

|Type: |Query

|Query Name: |Tabular Patient List

|Query Trigger (= MSH-9): |QBP^Z77^QBP_Q13

|Query Mode: |Both

|Response Trigger (= MSH-9): |RTB^Z78^RTB_K13

|Query Characteristics: a|

Query By Example: passes algorithm data via QBP segment and patient match information via PID segment.

Only PID fields listed in the QBE Input Parameter Specification may be populated to be matched against. Fields not populated will be considered as matching all returned records.

The PID segment is required for this query/response pattern.

Output columns are chosen from a Virtual Table.

|Purpose: |To find patient records that closely (as specified by the Client) match a set of input criteria using a specified algorithm.

|Response Characteristics: |Response returns requested columns from the Virtual Table. If no columns were requested, all columns are returned.

|Based on Segment Pattern: |

|===

The message structure for QBP^Z77^QPB_Q13 can be found in 5.3.1.2. Use the QBP^Q13^QPB_Q13 Message structure.

RTB^Z78^RTB_K13: Response Grammar: Who Am I

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec Ref

|MSH |Message Header | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|MSA |Message Acknowledgement | |2.15.8

|[ERR] |Error | |2.15.5

|link:#QAK[QAK] |Query Acknowledgement | |5.5.2

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|[ |--- ROW_DEFINITION begin | |

|link:#RDF[RDF] |Table Row Definition Segment | |5.5.7

|[\{ link:#RDT[RDT] }] |Table Row Data Segment | |5.5.8

|] |--- ROW_DEFINITION end | |

|[ DSC ] |Continuation Pointer | |2.15.4

|===

*QPD Input Parameter Specification*

[width="100%",cols="11%,14%,8%,3%,6%,8%,3%,3%,8%,8%,9%,8%,11%",options="header",]

|===

|Field Seq (Query ID=Z77) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|1 |MessageQueryName | | |60 |CWE |R | | | | | |Message Query Name

|2 |QueryTag | | |32 |ST |R | | | | | |Query Tag

|3 |Algorithm | | |*48* |*ST* | | | | | | |Algorithm

|4 |ConfidenceLevel | | |8 |NM | | | | | | |Confidence Level

|===

*QPD Input Parameter Field Description and Commentary*

[width="100%",cols="20%,11%,6%,63%",options="header",]

|===

|Input Parameter (Query ID=Z77) |Comp. Name |DT |Description

|MessageQueryName | |CWE |SHALL be valued *Z77^Tabular Patient List^HL7nnnn*.

|QueryTag | |ST |Unique to each query message instance.

|Algorithm | |ST |The name of the search algorithm that is used to look up the parameter values specified in the PID segment.

|ConfidenceLevel | |NM |The degree of accuracy that the search algorithm must achieve in order to score a "hit."

|===

*QBE Input Parameter Specification*

[width="99%",cols="16%,13%,8%,6%,5%,7%,5%,5%,7%,5%,9%,14%",]

|===

|Segment Field Name (Query ID=Z77) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Service Identifier Code |Element Name

|PID.5 |PatientName |*S* | |48 |XPN | | | | | |PID-5-Patient Name

|PID.7 |DOB |*S* | |24 |DTM | | | | | |PID-7-Date/time of Birth

|PID.8 |Sex |S | |1 |CWE | | | | | |PID-8-Sex

|===

*QBE Input Parameter Field Description and Commentary*

[width="100%",cols="17%,10%,7%,66%",]

|===

|Input Parameter (Query ID=Z77) |Comp. Name |DT |Description

|PatientName | |XPN |Name of the patient. May be specified in full or in part.

|DOB | |DTM |Date and time of the patient's birth. Year, month, and day SHALL be specified; time is optional.

|Sex | |CWE |Administrative gender of the patient.

|===

*RCP Response Control Parameter Field Description and Commentary*

[width="100%",cols="13%,25%,13%,6%,7%,36%",options="header",]

|===

|Field Seq (Query ID=Z77) |Name |Com­po­nent Name |LEN |DT |Description

|1 |Query Priority | |1 |ID |(*D*)eferred or (*I*)mmediate. Default is *I*.

|2 |Quantity Limited Request | |10 |CQ |

| | |Quantity | |NM |Number of units (specified by the following component) that will be returned in each increment of the response. If no value is given, the entire response will be returned in a single increment.

| | |Units | |CWE |**CH**aracters, **LI**nes, **P**a**G**es, or **R**ecor**D**s. Default is *LI*.

|3 |Response Modality | |60 |CWE |**R**eal time or **B**atch. Default is *R*.

|6 |Sort-by Field | |256 |SRT |

| | |Sort-by Field | |ST |Segment field name of an output column by which the response may be sorted. SHALL contain a *Y* in the Sort column of the output specification table.

| | |Sequencing | |ID |As specified in HL7 Table 0397- Sequencing. Default is **A**scending.

|===

*Output Specification and Commentary: Virtual Table*

[width="99%",cols="19%,9%,3%,6%,8%,3%,6%,8%,8%,10%,11%,9%",options="header",]

|===

|ColName (Query ID=Z77) a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|PatientList |*S* |*Y* |*20* |*CX* |*O* | | | |PID.3 | |PID-3 Patient Identifier List

|PatientName | | |48 |XPN | | | | |PID.5 | |PID-5 Patient Name

|MothersMaidenName | | |48 |XPN | | | | |PID.6 | |PID-6 Mother's Maiden Name

|DOB | | |24 |DTM | | | | |PID.7 | |PID-7 Date/Time of Birth

|Sex | | |1 |CWE | | | | |PID.8 | |PID-8 Sex

|Race | | |80 |CWE | | | | |PID.10 | |PID-10 Race

|===

The same query as described above could be sent as a pure Query by Parameter query, without the "query by example" variant, as follows.

Notice that the query uses only a single QPD segment to carry all the parameters. The response to the query is the same as for the "query by example" variant above.

Example: the Client wishes to do this using the peekaboo algorithm with an 80% confidence level.

MSH|^~\&|PCR|GenHosp|MPI||199811201400-0800||QBP^Z75^QBP_Q13|8699|P|2.8||||||||

QPD|Z75^find_candidates^HL7nnnn|Q0001|peekaboo|80|Nuclear^Ned|19481211|M

RDF|PatientList^CX^20~PatientName^XPN^48~Mother'sMaidenName^XPN^48~DOB^DTM^24~Sex^IS^1~Race^CWE^80|

RCP|I|999^RD|

The MPI system returns the following RTB message:

**MSH**|^~\&|MPI|GenHosp|PCR||199811201400-0800||RTB^Z76^RTB_R13|8699|P|2.8||||||||

**MSA**|AA|8699|

**QAK**|

QPD|Z75^find_candidates^HL7nnnn|Q0001|peekaboo|80|Nuclear^Ned|19481211|M

**RDF**|PatientList^CX^20~PatientName^XPN^48~Mother'sMaidenName^XPN^48~DOB^DTM^24~Sex^IS^1~Race^CWE^80|

**RDT**|555444222111^^^MPI&KP.NCA&L^MR|Nuclear^Ned|19481211|M||

==== MPI Query Profile – Non query by example version

Query Profile

[width="100%",cols="39%,61%",options="header",]

|===

|Query Statement ID (Query ID=Z75): |Z75

|Type: |Query

|Query Name: |Tabular Patient List

|Query Trigger (= MSH-9): |QBP^Z75^QBP_Q13

|Query Mode: |Both

|Response Trigger (= MSH-9): |RTB^Z76^RTB_K13

|Query Characteristics: |Patient identifier and matching algorithm requirements are passed via the input parameters. Output columns are chosen from a Virtual Table.

|Purpose: |To find patient records that closely (as specified by the Client) match a set of input criteria using a specified algorithm.

|Response Characteristics: |Response returns requested columns from the Virtual Table. If no columns were requested, all columns are returned.

|Based on Segment Pattern: |

|===

The message structure for QBP^Z75^QPB_Q13 can be found in 5.3.1.2. Use the QBP^Q13^QPB_Q13 Message structure.

RTB^Z76^RTB_K13: Response Grammar: Who Am I

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec Ref

|MSH |Message Header | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|MSA |Message Acknowledgement | |2.15.8

|[ERR] |Error | |2.15.5

|link:#QAK[QAK] |Query Acknowledgement | |5.5.2

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|[ |--- ROW_DEFINITION begin | |

|link:#RDF[RDF] |Table Row Definition Segment | |5.5.7

|[\{ link:#RDT[RDT] }] |Table Row Data Segment | |5.5.8

|] |--- ROW_DEFINITION end | |

|[ DSC ] |Continuation Pointer | |2.15.4

|===

*QPD Input Parameter Specification*

[width="100%",cols="11%,14%,8%,3%,6%,8%,3%,3%,8%,8%,9%,8%,11%",options="header",]

|===

|Field Seq (Query ID=Z75) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element

|1 |MessageQueryName | | |60 |CWE |R | | | | | |Message Query Name

|2 |QueryTag | | |32 |ST |R | | | | | |Query Tag

|3 |Algorithm | | |*48* |*ST* | | | | | | |Algorithm

|4 |ConfidenceLevel | | |8 |NM | | | | | | |Confidence Level

|5 |PatientName |S | |48 |XPN | | | | |PID.5 | |PID-5-Patient Name

|6 |DOB |S | |24 |DTM | | | | |PID.7 | |PID-7-Date/Time of Birth

|7 |Sex |S | |1 |CWE | | | | |PID.8 | |PID-8-Sex

|===

*QPD Input Parameter Field Description and Commentary*

[width="100%",cols="20%,11%,6%,63%",options="header",]

|===

|Input Parameter (Query ID=Z75) |Comp. Name |DT |Description

|MessageQueryName | |CWE |SHALL be valued *Z75^Tabular Patient List^HL7nnnn*.

|QueryTag | |ST |Unique to each query message instance.

|Algorithm | |ST |The name of the search algorithm that is used to look up the parameter values specified in the PID segment.

|ConfidenceLevel | |NM |The degree of accuracy that the search algorithm must achieve in order to score a 'hit'.

|PatientName | |XPN |Name of the patient. May be specified in full or in part.

|DOB | |DTM |Date and time of the patient's birth. Year, month, and day SHALL be specified; time is optional.

|Sex | |CWE |Administrative gender of the patient.

|===

*RCP Response Control Parameter Field Description and Commentary*

[width="100%",cols="13%,25%,13%,6%,7%,36%",options="header",]

|===

|Field Seq (Query ID=Z75) |Name |Com­po­nent Name |LEN |DT |Description

|1 |Query Priority | |1 |ID |(*D*)eferred or (*I*)mmediate. Default is *I*.

|2 |Quantity Limited Request | |10 |CQ |

| | |Quantity | |NM |Number of units (specified by the following component) that will be returned in each increment of the response. If no value is given, the entire response will be returned in a single increment.

| | |Units | |CWE |**CH**aracters, **LI**nes, **P**a**G**es, or **R**ecor**D**s. Default is *LI*.

|3 |Response Modality | |60 |CWE |**R**eal time or **B**atch. Default is *R*.

|6 |Sort-by Field | |256 |SRT |

| | |Sort-by Field | |ST |Segment field name of an output column by which the response may be sorted. SHALL contain a *Y* in the Sort column of the output specification table.

| | |Sequencing | |ID |As specified in HL7 Table 0397- Sequencing. Default is **A**scending.

|===

*Output Specification and Commentary: Virtual Table*

[width="99%",cols="19%,9%,3%,6%,8%,3%,6%,8%,8%,10%,11%,9%",options="header",]

|===

|ColName (Query ID=Z75) a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|PatientList |*S* |*Y* |*20* |*CX* |*O* | | | |PID.3 | |PID-3 Patient Identifier List

|PatientName | | |48 |XPN | | | | |PID.5 | |PID-5 Patient Name

|MothersMaidenName | | |48 |XPN | | | | |PID.6 | |PID-6 Mother's Maiden Name

|DOB | | |24 |DTM | | | | |PID.7 | |PID-7 Date/Time of Birth

|Sex | | |1 |CWE | | | | |PID.8 | |PID-8 Sex

|Race | | |80 |CWE | | | | |PID.10 | |PID-10 Race

|===

