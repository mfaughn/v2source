= General Use Cases / Background
:render_as: Level4
:v291_section: 5.3+;5.4;5.6;5.7

== QUERY/RESPONSE PROFILE

The introduction of the Query/Response Profilefootnote:[Formerly known as the Conformance Statement, this artifact will be referred to throughout the rest of this document as the *Query Profile* to distinguish it from an implementor assertion of conformance to a particular profile. The Query Profile is understood to include the definition of the appropriate response message(s).] concept is not intended to imply system certification. It is intended to promote the definition and implementation of well-specified queries. As in previous versions, support for queries is not required for HL7 conformance.

In the introduction, the data owner describes the data being made available and the purpose of the query. He specifies the exact coded value for the Query Name which the Client SHALL use to invoke this query.

The Query Grammar defines the exact segments the Client MAY send. For each field of those segments, the Query Profile SHALL define how the Server will interpret client values. (For example, the patient name field is interpreted as a regular expression match.)

The Response Grammar defines the exact pattern of segments that the Server will return. Each Segment Pattern Response will specify its own pattern of segments. (For example, lab data queries will return patterns of OBR and OBX, while demographic queries might respond with patterns of PID, PV1,... segments.) When a data owner defines a tabular response query, the response grammar might simply be a list of RDT segments that carry rows of data. The user selects columns from a Virtual Table to define the output for the Query by Parameter/Tabular Response (QBP/RTB).

Note that in the case of an HL7-defined query, a specific section of the HL7 Standard will define a Query Profile. By contrast, in the case of a site defined query, the Query Profile is written by analysts and programmers of the Server application/system, and is available to the analysts and programmers of the Client application/system.

Although the Query Profile was a new construct with Version 2.4, it may also be used with the previous generation queries.

*Note:* Version 2.5 introduced a new, use-case-based mechanism for conformance in Chapter 2. Query implementers are encouraged to review and, where appropriate, adopt the profiling structures outlined in that chapter. Current Query Profile structures are retained in Chapter 5 pending revision to the new structures in the next version of the Standard.

=== Using the Query Profile

Critical to the proper usage of the new query/response pairs is the Query Profile concept. In the absence of a Query Profile, the Client might not be aware of the existence of a query, or might not know how to use it or what to expect from it.

The Server advertises the existence of, and support for, a query by publishing a *_Query Profile_*. The Query Profile identifies the query, specifies what items can be queried and describes what the response will look like.

*Query Profile:* A declaration which sets forth the name of the query supported by the Server, the logical structure of the information that can be queried, and the logical structure of what can be returned.

A number of examples of Query Profiles can be found in section _5.9_, "_QUERY/RESPONSE MESSAGE EXAMPLES_."

==== Query with tabular response example

The user wishes to know the identity of the patient whose medical record number is "555444222111".

MSH|^~\&|PCR|GenHosp|MPI||199811201400-0800||QBP^Q40^QBP_Q13|8699|P|2.8||||||||

QPD|Q40^WhoAmI^HL7nnnn|Q0001|555444222111^^^MPI^MR|||19980531|19990531|

RCP|I|

RDF|6|PatientList^CX^20~PatientName^XPN^48~Mother'sMaidenName^XPN^48~DOB^DTM^24~Sex^IS^1~Race^CWE^80|

The MPI system returns the following RTB message

MSH|^~\&|MPI|GenHosp|PCR||199811201400-0800||RTB^K13^RTB_K13|ACK9901|P|2.8||||||||

MSA|AA|8699|

QAK|Q0001|OK|Q40^WhoAmI^HL7nnnn|1|

QPD|Q28^WhoAmI^HL7nnnn|Q0001|555444222111^^^MPI^MR|||19980531|19990531|

RDF|6|PatientList^CX^20~PatientName^XPN^48~Mother'sMaidenName^XPN^48~DOB^DTM^24~Sex^IS^1~Race^CWE^80|

RDT|555444222111^^^MPI^MR|Everyman^Adam||19600614|M||

==== Example of Query Profile with tabular response

Query Profile

[width="100%",cols="39%,61%",options="header",]

|===

|Query Statement ID (Query ID=Z99): |Z99

|Type: |Query (or Publish)

|Query Name: |Who Am I

|Query Trigger (= MSH-9): |QBP^Z99^QBP_Q13

|Query Mode: |Both

|Response Trigger (= MSH-9): |RSP^Z84^RSP_Z84

|Query Characteristics: |Returns response sorted by PatientLastName unless otherwise specified. Note that neither the PID nor the RDF segments are used.

|Purpose: |Find the identity of the patient for specified medical record number(s)

|Response Characteristics: |Returns response sorted by PatientLastName unless otherwise specified.

|Based on Segment Pattern: |

|===

QBP^Z99^QBP_Q13: Query Grammar: QBP Message

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec Ref

|MSH |Message Header Segment | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|[ PID ] |Patient Identification Segment | |3.4.2

|[ link:#RDF[RDF] ] |Table Row Definition Segment | |5.5.6.6

|link:\l[RCP] |Response Control Parameter | |5.5.6

|[ RDF ] |Table Row Definition Segment | |5.5.6.6

|[ DSC ] |Continuation Pointer | |2.15.4

|===

[width="100%",cols="21%,31%,24%,24%",options="header",]

|===

|Acknowledgement Choreography | | |

|QBP^Z99^QBP_Q13 | | |

|Field name |Field Value: Original mode |Field value: Enhanced mode |

|MSH-15 |Blank |NE |AL, SU, ER

|MSH-16 |Blank |AL |AL

|Immediate Ack |- |- |ACK^Z84^ACK

|Application Ack |RSP^Z84^RSP_Z84 |RSP^Z84^RSP_Z84 |RSP^Z84^RSP_Z84

|===

RSP^Z84^RSP_Z84: Response Grammar: RTB Message

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec Ref

|MSH |Message Header Segment | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|MSA |Message Acknowledgement | |2.15.8

|[ ERR ] |Error | |2.15.5

|link:#QAK[QAK] |Query Acknowledgement | |5.4.2

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|[ |--- ROW_DEFINITION begin | |

|link:#RDF[RDF] |Table Row Definition Segment | |5.5.6.6

|[ \{ link:#RDT[RDT] } ] |Table Row Data Segment | |5.5.6

|] |--- ROW_DEFINITION end | |

|[ DSC ] |Continuation Pointer | |2.15.4

|===

[width="100%",cols="24%,37%,10%,29%",options="header",]

|===

|Acknowledgement Choreography | | |

|RSP^Z84^RSP_Z84 | | |

|Field name |Field Value: Original mode |Field value: Enhanced mode |

|MSH-15 |Blank |NE |AL, SU, ER

|MSH-16 |Blank |NE |NE

|Immediate Ack |- |- |ACK^Z84^ACK

|Application Ack |- |- |-

|===

*QPD Input Parameter Specification*

[width="100%",cols="11%,14%,8%,3%,6%,8%,3%,3%,8%,8%,9%,8%,11%",options="header",]

|===

|Field Seq (Query ID=Z99) |Field Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|1 |MessageQueryName | | |60 |CWE |R | | | | | |

|2 |QueryTag | | |32 |ST |R | | | | | |

|3 |PatientList |S |Y |20 |CX |O | | | |PID-3 | |PID-3 Patient Identifier List

|===

*QPD Input Parameter Field Description and Commentary*

[width="100%",cols="20%,11%,6%,63%",options="header",]

|===

|Input Parameter (Query ID=Z99) |Comp. Name |DT |Description

|MessageQueryName | |CWE |SHALL be valued *Z99^WhoAmI^HL7nnnn*.

|QueryTag | |ST |Unique to each query message instance.

|PatientList | |CX |

| | | |Components: <ID (ST)> ^ <check digit (ST)> ^ <code identifying the check digit scheme employed (ID)> ^ < assigning authority (HD)> ^ <identifier type code (IS)> ^ < assigning facility (HD)>

| | | |The combination of values for _PatientID, and PatientIDAssigningAuthority,_ are intended to identify a unique entry on the PATIENT_MASTER table. The PatientIDTypeCode is useful for further filtering or to supply uniqueness in the event that the assigning authority may have more than one coding system. (The PATIENT_MASTER table contains a constraint that prevents multiple patients from being identified by the same combination of field values.) This PATIENT_MASTER entry will be searched against on the PHARMACY_DISPENSE_TRANSACTION table to retrieve the rows fulfilling the query conditions.

| | | |If this field is not valued, all values for this field are considered to be a match.

| | | |

| |ID |ST |If this field, PID.3.1, is not valued, all values for this field are considered to be a match.

| |Assigning Authority |HD |If this field, PID.3.4, is not valued, all values for this field are considered to be a match.

| |Identifier Type Code |CWE |If this field, PID.3.5, is not valued, all values for this field are considered to be a match.

|===

*RCP Response Control Parameter Field Description and Commentary*

[width="100%",cols="13%,25%,13%,6%,7%,36%",options="header",]

|===

|Field Seq (Query ID=Z99) |Name |Com­po­nent Name |LEN |DT |Description

|1 |Query Priority | |1 |ID |(*D*)eferred or (*I*)mmediate. Default is *I*.

|2 |Quantity Limited Request | |10 |CQ |

| | |Quantity | |NM |Number of units (specified by the following component) that will be returned in each increment of the response. If no value is given, the entire response will be returned in a single increment.

| | |Units | |CWE |**CH**aracters, **LI**nes, **P**a**G**es, or **R**ecor**D**s. Default is *LI*.

|3 |Response Modality | |60 |CWE |**R**eal time or **B**atch. Default is *R*.

|6 |Sort-by Field | |256 |SRT |

| | |Sort-by Field | |ST |Segment field name of an output column by which the response may be sorted. SHALL contain a *Y* in the Sort column of the output specification table.

| | |Sequencing | |ID |As specified in HL7 Table 0397- Sequencing. Default is **A**scending.

|===

*Output Specification and Commentary: Virtual Table*

[width="99%",cols="19%,9%,3%,6%,8%,3%,6%,8%,8%,10%,11%,9%",options="header",]

|===

|ColName (Query ID=Z99) a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|PatientList |S |Y |20 |CX |O | | | |PID.3 | |PID-3: Patient Identifier List

|PatientName | | |48 |XPN | | | | |PID.5 | |PID-5 Patient Name

|Mother'sMaidenName | | |48 |XPN | | | | |PID.6 | |PID-6 Mother's Maiden Name

|DOB | | |24 |DTM | | | | |PID.7 | |PID-7 Date/Time of Birth

|Sex | | |1 |CWE | | | | |PID.8 | |PID-8 Sex

|Race | | |80 |CWE | | | | |PID.10 | |PID-10 Race

|===

=== Formal specification of the Query Profile

The Query Profile contains the following information:

Query Profile ID: The unique identifier applying to this query's Query Profile. This value is transmitted as the first component of _QPD-1-Message query name_. For sites implementing the Conformance SIG's Implementation Guide, this value shall also be transmitted in _MSH-21-Query Profile ID_.

Formal Query Name: identifies a unique query or publication, e.g., PharmacyDispenseHistory.

Query Trigger: identifies the trigger event for the query. Note that more than one Query Profile may map to the same generic trigger event (Q10 through Q15). If a non-generic trigger event is used, it should correspond to exactly one Query Profile.

The use of Q for HL7-standard query trigger events is conventional; another letter may be used if the supply of Q triggers is exhausted.

The assignment of a trigger event, while mandatory, is intended to facilitate processing rather than to identify a query uniquely. A query is uniquely identified by the value transmitted in _QPD-1-Message query name_. This value SHALL be the same in both the query and response messages, even though the trigger event for the query differs from the trigger event for the response.

Response Trigger: identifies the unique trigger event for the response. Note that more than one Query Profile may map to the same generic trigger event (K10 through K15). If a non-generic trigger event is used, it should correspond to exactly one Query Profile.

The use of K for HL7-standard response trigger events is conventional; another letter may be used if the supply of K triggers is exhausted.

Query Priority: Specifies if the query is immediate, deferred or selectable.

Query Characteristics: Narrative describing general feature of the query.

Purpose: Describes intent of query.

Query Grammar: defines the logical structure of what can be sent by the Client. The structure of this part of the Query Profile is very similar in appearance to a message syntax.

Response Grammar: defines the logical structure of what can be returned by the Server. The structure of this part of the Query Profile is very similar in appearance to a message syntax with two additional columns: Comment and Support Indicator.

Data Model: the logical structure of the information that can be queried. It can be thought of as a set of rows or a list of items having the same format as the Virtual Table structure described in the next section. This works for both tabular and segment pattern queries. A display query can be considered as orthogonal to the tabular and segment pattern queries and follows the same input structure. This is not always included in the Query Profile.

Input Parameter Field Specification and Commentary: Cites the allowable parameters that can be passed to the recipient. The structure of this part of the Query Profile is very similar in appearance to an HL7 Segment Attribute Table with several additional columns: ColName, Key/Search, Sort, MatchOp, SegmentFieldName, and Service Identifier Code.

A QPD Input Parameters table and corresponding explanation table is always provided. These tables discuss all the fields of the QPD segment, including _QPD-1-Message query name_ and _QPD-2-Query tag_. If the query is a Query by Example, additional input parameters and explanation tables are provided for all the fields that may be populated in the example segments.

Response Control: Specifies execution date and time, restrictions on amount of data, and query modality. This is not always included in the Query Profile.

Output Specification and Commentary: Used for tabular and display response. For the tabular response, it specifies the column names that will be returned. The structure of this part of the Query Profile is very similar in appearance to an Attribute Table with several additional columns: ColName, Key/Search, Sort, MatchOp, SegmentFieldName, and Service Identifier Code. For the display response, it describes the format of the data that will be returned.

Note that in the case of an HL7-defined query, a specific section of the HL7 standard will define a Query Profile. The existence of a standard Query Profile for any given query does *not* mean that a system SHALL implement this particular query to be conformant to the HL7 Standard. However, systems that do implement the query SHALL follow the specifications as given in the Query Profile.

Sites that wish to offer queries not specified by the Standard may create their own Query Profiles. By contrast to an HL7-standard query, in the case of a site defined query, the Query Profile is written by the Server, and is available to the analysts and programmers of the Client system to enable them to know the exact behavior of the Server.

Although the Query Profile was a new construct with version 2.4, it may also be used with the previous generation queries.

Input Parameter Specification and Input Field Description and Commentary are always included for the QPD segment. When the Query by Example variant is used, they are provided for the QBE as well. An Output Specification and Commentary showing a Virtual Table is provided for queries that accommodate a tabular response.

For Query Profiles published in the HL7 Standard, each table includes the Query Profile ID in parentheses in the upper left-hand cell. This allows the table to be imported automatically into the HL7 database.

==== Steps for developing a Query Profile

____

{empty}1) Before composing the Query Profile, express the query in ordinary English sentences.

{empty}2) Transform the query into a mathematical or pseudo-language statement. A syntax such as SQL provides a useful mechanism.

{empty}3) From the pseudo-statement, extract the parameters and the operations upon the parameters.

{empty}4) Advertise the parameters in the Query Profile.

{empty}5) Within the Query Profile, explain the operations that will be performed upon the parameters: relational conjunctions, equality/inequality, etc. Use examples to aid the user in understanding how the query might be invoked in specific instances.

____

==== Query Profile introduction

The Query Profile begins with a table that summarizes the characteristics and identifying information about the query to which the Query Profile applies.

Query Profile

[width="100%",cols="39%,61%",options="header",]

|===

|Query Statement ID (Query ID=Znn): |Znn

|Type: |

|Query Name: |

|Query Trigger (= MSH-9): |

|Query Mode: |

|Response Trigger (= MSH-9): |

|Query Characteristics: |

|Purpose: |

|Response Characteristics: |

|Based on Segment Pattern: |

|===

*Query Statement ID*: The unique identifier applying to this Query Profile. This value is transmitted as the first component of _QPD-1-Message query name_.

*Type*: Usually *Query*, except for publish-and subscribe Query Profiles (see section _5.7.3.1_, "_Example of a publish and subscribe Query Profile_") for which the value should be *Publish*.

*Query Name*: The name corresponding to the identifier in *Query Statement ID*. This value is transmitted as the second component of _QPD-1-Message query name_.

*Query Trigger (= MSH-9)*: The exact value that the Client will transmit in the _MSH-9-Message type_ field of the query message.

*Query Mode*: Whether the query may be sent in *Real time* (including Bolus) or in *Batch*; see section _5.5.6.3_, "_Interactive continuation of response messages_." The value *Both* indicates that both real-time/bolus and batch modes are acceptable.

*Response Trigger (= MSH-9)*: The exact value that the Server will transmit in the _MSH-9-Message type_ field of the response message.

*Query Characteristics*: Particular features of this query. This is free text intended to help the query implementor in selecting among queries.

*Purpose*: The end result that this query is intended to accomplish. Free text.

*Response Characteristics*: Particular features of this response. This is free text intended to help the query implementor in selecting among queries.

*Based on Segment Pattern*: For queries that return a segment pattern response, this is the (non-query response) message type upon which the segment pattern is based.

==== Query grammar

The Query Profile shows a query grammar. This is a brief model of the segments used in the query message.

QBP^Znn^QBP_Qnn: Query Grammar: QBP Message

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec Ref

|MSH |Message Header Segment | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|[ link:#RDF[RDF] ] |Table Row Definition Segment | |0

|link:#RCP[RCP] |Response Control Parameter | |5.5.6

|[ DSC ] |Continuation Pointer | |2.15.4

|===

[width="100%",cols="21%,31%,24%,24%",options="header",]

|===

|Acknowledgement Choreography | | |

|QBP^Znn^QBP_Qnn | | |

|Field name |Field Value: Original mode |Field value: Enhanced mode |

|MSH-15 |Blank |NE |AL, SU, ER

|MSH-16 |Blank |AL |AL

|Immediate Ack |- |- |ACK^Znn^ACK

|Application Ack |RTB^Znn^RTB_Knn |RTB^Znn^RTB_Knn |RTB^Znn^RTB_Knn

|===

*Query Grammar*: This and the following column specify the HL7 code name and full name of each segment sent in the query. Braces specify that the segment or segment group is repeatable; brackets specify the optionality of the segment or segment group.

*Section Reference*: Specifies where in the standard further information about the segment can be found.

When the Query by Example variant is used, the Query Grammar shows the segments that may be used to transmit parameters and the order in which they appear. Segments used to transmit parameters are always sent immediately following the QPD segment.

==== Response grammar

The Query Profile always shows a response grammar. If the query response is segment pattern, the response grammar should specify the segments, order, optionality, and repetition as do message specifications within the HL7 Standard.

RTB^Znn^RTB_Knn: Response Grammar: Widget Dispense Message

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec Ref

|MSH |Message Header | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|MSA |Message Acknowledgement | |2.15.8

|[ERR] |Error | |2.15.5

|link:#QAK[QAK] |Query Acknowledgement | |5.5.2

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|... | | |

|[ DSC ] |Continuation Pointer | |2.15.4

|===

[width="100%",cols="21%,31%,24%,24%",options="header",]

|===

|Acknowledgement Choreography | | |

|RTB^Znn^RTB_Knn | | |

|Field name |Field Value: Original mode |Field value: Enhanced mode |

|MSH-15 |Blank |NE |AL, SU, ER

|MSH-16 |Blank |AL |AL

|Immediate Ack |- |- |ACK^Znn^ACK

|===

*Response Grammar*: This and the following column specify the HL7 code name and full name of each segment returned in the response. Braces specify that the segment or segment group is repeatable; brackets specify the optionality of the segment or segment group.

For Query Profiles published in the HL7 Standard, the Response Grammar table includes the Query Profile ID in parentheses in the upper left-hand cell. This allows the table to be imported automatically into the HL7 database.

*Message Description*: The full text name of the segment.

*Group Control*: The name of a segment group.

*Comment*: Specifies in English: 1) the opening or closing of a segment group, and 2) the relevance of the segment in a Hit Count. (Only positive value is noted.)

*Support Indicator*: Allows the Server to indicate: 1) whether an optional segment or segment group will be supported, or 2) that the segment or segment group is dependent on an input parameter. The default understanding is that if the Server knows the information, it will be sent.

*Sec Ref*: Specifies where in the standard further information about the segment can be found.

==== Response grammar for display response

The response grammar for a display response lists the segment names, descriptions, and section references for the segments to be returned by the Server, as described in the previous section. In addition, the print text is displayed, as in the following example.

RDY^Znn^RDY_K15: Response Grammar: Dispense History

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec Ref

|MSH |Message Header | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|MSA |Message Acknowledgement | |2.15.8

|[ERR] |Error | |2.15.5

|link:#QAK[QAK] |Query Acknowledgement | |5.5.2

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|[\{ link:#DSP[DSP] }] |Display Data | |5.5.1

|[ DSC ] |Continuation Pointer | |2.15.4

|===

[width="100%",cols="21%,31%,24%,24%",options="header",]

|===

|Acknowledgement Choreography | | |

|RDY^Znn^RDY_K15 | | |

|Field name |Field Value: Original mode |Field value: Enhanced mode |

|MSH-15 |Blank |NE |AL, SU, ER

|MSH-16 |Blank |AL |AL

|Immediate Ack |- |- |ACK^Znn^ACK

|Application Ack |- |- |-

|===

[width="100%",cols="100%",options="header",]

|===

|The data will display as follows: (Query ID=Z99)

|DSP\|\|\| GENERAL HOSPITAL – PHARMACY DEPARTMENT DATE:mm-dd-yy

|DSP\|\|\| DISPENSE HISTORY REPORT PAGE n

|DSP\|\|\|MRN Patient Name MEDICATION DISPENSED DISP-DATE

|DSP\|\|\|XXXXX XXXXXx, XXXXX XXXXXXXXXXXXXXXX mm/dd/ccyy

|...

|DSP\|\|\| << END OF REPORT >>

|===

==== QPD input parameter specification

The Input Parameter Specification section of the Query Profile looks very much like an attribute table and is followed by a commentary on the fields. Each row of the QPD Input Parameter Specification specifies one user parameter within the QPD segment. Values for user parameters are transmitted in successive fields of the QPD segment, beginning at QPD-3.

When the QSC variant is employed (see section _5.2.5.1.3_, "_Expression as a complex expression_"), a complex query expression may be used as the only input parameter, or may be combined with other (simple) input parameters.

*QPD Input Parameter Specification*

[width="100%",cols="11%,14%,8%,3%,6%,8%,3%,3%,8%,8%,9%,8%,11%",options="header",]

|===

|Field Seq (Query ID=Z99) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

| | | | | | | | | | | | |

|===

The following is a description of the attributes of the above table.

*Field Seq*: The ordinal number of the element being discussed. Sequence 1 is [.underline]#always# Message Query Name, and sequence 2 is [.underline]#always# Query Tag. Sequence 3 and above are reserved for user parameters.

*Name*: the user-defined name for the element as will be used in the query. Example: MedicationDispensed. When *Name* is derived from an actual HL7 element (segment and field), the segment field name and element name appear in the columns headed by those names. When *Name* is not derived from an actual HL7 element (segment and field), the source system defines the values they expect in this field.

For Query Profiles published in the HL7 Standard, the Input Parameter Specification table includes the Query Profile ID in parentheses in the upper left-hand cell. This allows the table to be imported automatically into the HL7 database.

*Key/Search*: This field identifies which element is the key and which elements are searchable. The key field is designated by a value of 'K'. A value of 'S' designates fields upon which an indexed search can be performed by the source. 'L' designates non-indexed fields. (Note that searching on a non-indexed field requires the Server to perform a linear scan of the data base.) If this column is left blank, the field may not be searched.

*Sort*: valued as "Y" if the output of the query can be sorted on this field. This column should only be valued in Virtual Tables that are used as output specifications.

*Len*: the maximum field length that will be transmitted by the source.

*Type*: the data type of this user parameter. The values available for this field are described in Chapter 2, section 2.16 of this standard. Data types QIP and QSC are available for transmitting complex user parameters.

*Opt*: defines whether the field is required ('R'), optional ('O'), conditionally required ('C'), or required for backward compatibility ('B').

*Rep*: valued as 'Y' if the field may repeat (i.e., be multiply valued).

*Match Op*: the relational operator that will be applied against the value that the querying system specifies for this field.

*Note:* These are defined by file:///E:\V2\v2.9%20final%20Nov%20from%20Frank\V29_CH02C_Tables.docx#HL70209[_HL7 Table 0209 – Relatio__nal Operator_], a component of the QSC data type

*TBL*: identifies the HL7 table from which the values are derived.

*Segment Field Name*: identifies the HL7 segment and field from which the new definition is derived. This field will be blank if the Name is NOT derived from an actual HL7 segment and field.

*Service Identifier Code:* a value of data type CWE that contains the applicable LOINC code, if it exists, or the applicable HL7 code, if it exists, if no Segment Field Name has been identified. If a Segment Field Name has been identified, this field is not populated.

*Element Name*: the name of the element identified by Segment Field Name. This may also be a user-defined 'Z'-element.

==== QPD input parameter field description and commentary

The QPD Input Parameter Field Description and Commentary provides a more detailed description of each of the fields transmitted in the QPD segment.

[width="100%",cols="21%,11%,6%,62%",options="header",]

|===

|Input Parameter (Query ID=Znn) |Comp. Name |DT |Description

|MessageQueryName | |CWE |SHALL be valued *Z99^WhoAmI^HL7nnnn*.

|QueryTag | |ST |Unique to each query message instance.

|InputItem... | |CX |

|===

*Input Parameter*: The name of the field whose value is being transmitted.

*Comp. Name*: When the *Input Parameter* is of a composite data type (e.g._,_ XPN), this is the name of an individual component of the composite input parameter. Only those components that may be valued should be listed in this column.

*DT*: The data type of the parameter or component.

*Description*: A narrative description of the parameter or component and how it is to be used.

==== QBE input parameter specification

In the Query by Example variant, discussed below in section _5.9.7_, "_ +

Query by example (QBP) / tabular response (RTB_)," the Query Profile may specify that the client may use fields within actual message segments, such as the PID segment, to transmit parameter information. Where this is permitted, the Query Profile includes a "QBE Input Parameter Specification" table to specify which fields may be used to transmit the parameters.

*QBE Input Parameter Specification*

[width="99%",cols="13%,14%,9%,3%,6%,7%,5%,5%,8%,6%,12%,12%",options="header",]

|===

|Segment Field Name (Query ID=Z99) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Service Identifier Code |Element Name

| | | | | | | | | | | |

|===

Fields are indicated by their actual Segment Field Name, which specifies both segment and position. Except for this distinguishing feature, the remaining columns in this table are identical in meaning to their counterparts in the "_QPD input parameter specification_" in section _5.3.2.6_ above.

Each row of the QBE Input Parameter Specification specifies one field that may be used to transmit user parameters within the example segment(s).

==== QBE input parameter field description and commentary

The QPD Input Parameter Field Description and Commentary provides a more detailed description of each of the fields transmitted in the example segments sent in a Query by Example.

*QBE Input Parameter Field Description and Commentary*

[width="100%",cols="17%,11%,8%,64%",]

|===

|Input Parameter (Query ID=Znn) |Comp. Name |DT |Description

| | | |

|===

Fields are indicated by their actual Segment Field Name, which specifies both segment and position. Except for this distinguishing feature, the remaining columns in this table are identical in meaning to their counterparts in the "_QPD input parameter field description and commentary_" in section _5.3.2.7_ above.

==== RCP input parameter field description and commentary

The RCP Input Parameter Field Description and Commentary provides a more detailed description of each of the fields transmitted in the RCP (Response Control Parameters) segment.

*RCP Response Control Parameter Field Description and Commentary*

[width="100%",cols="19%,22%,11%,5%,5%,38%",options="header",]

|===

|Field Seq (Query ID=Znn) |Name |Com­po­nent Name |LEN |DT |Description

| | | | | |

|===

*Field Seq*: The position within the RCP segment that the field occupies.

*Name*: The name of the field whose value is being transmitted.

*Component Name*: When the field referenced by *Name* is of a composite data type (e.g., XPN), this is the name of an individual component of the composite input parameter. Only those components that may be valued should be listed in this column.

*LEN*: The maximum length of the field.

*DT*: The data type of the parameter or component.

*Description*: A narrative description of the parameter or component and how it is to be used.

==== Input specification: virtual table

When the QSC variant is in use, the Query Profile includes a Virtual Table specification listing the fields that the Client may include in the complex expression parameter.

*Input Specification: Virtual Table*

[width="99%",cols="19%,9%,3%,6%,8%,3%,6%,8%,8%,10%,11%,9%",options="header",]

|===

|ColName (Query ID=Znn) a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

| | | | | | | | | | | |

|===

The *ColName* column identifies each field name that the Client may include in the complex query expression. Other columns in this table are defined as in section _5.3.2.6_ above.

When both the QSC variant and a tabular response are specified, this table is labeled "Input/Output Specification: Virtual Table" and no separate output specification is provided.

==== Virtual table field description and commentary

The Virtual Table Field Description and Commentary provides a more detailed description of each of the fields listed in the Virtual Table.

*Virtual Table Field Description and Commentary*

[width="100%",cols="19%,11%,6%,64%",options="header",]

|===

|ColName (Query ID=Znn) |Comp. Name |DT |Description

| | | |

|===

*ColName*: The name used to identify the column, or field, in the complex expression.

*Comp. Name*: When the *ColName* is of a composite data type (e.g., XPN), this is the name of an individual component of the column. Only those components that may be valued should be listed.

When specifying a field in the complex expression, both the *ColName* and *Comp. Name* attributes should be sent if only a single component is being identified. For instance, *PatientList.ID* would specify the ID component of the *PatientList* field.

*DT*: The data type of the field or component.

*Description*: A narrative description of the field or component and how it is to be used.

==== Output specification for tabular response

The output specification for the tabular response consists of the Virtual Table description, i.e., the columns and rows. It has the same columns as the input specification, but the rows reflect all of the available rows in the table, not just those that can be filtered upon input.

*Output Specification and Commentary: Virtual Table*

[width="99%",cols="19%,9%,3%,6%,8%,3%,6%,8%,8%,10%,11%,9%",options="header",]

|===

|ColName (Query ID=Z99) a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

| | | | | | | | | | | |

|===

The usage of the columns in this table is as described in section _5.3.2.8_, "_QBE input parameter specification_." Note that the Key/Search and Match Op fields are only meaningful when a virtual table is used in the input specification (QSC variant).

When the QSC variant is in use, the "Input/Output Specification and Commentary" virtual table is used for selection of output fields. No separate table is specified for output.

=== Query Profile templates

==== Query Profile template for query with tabular response

Query Profile

[width="100%",cols="39%,61%",options="header",]

|===

|Query Statement ID (Query ID=Znn): |

|Type: |

|Query Name: |

|Query Trigger (= MSH-9): |

|Query Mode: |

|Response Trigger (= MSH-9): |

|Query Characteristics: |

|Purpose: |

|Response Characteristics: |

|Based on Segment Pattern: |

|===

The message structure for QBP^Znn^QPB_Q13 can be found in 5.3.1.2. Use the QBP^Q13^QPB_Q13 Message structure.

RTB^Znn^RTB_K13: Response Grammar: RTB Message

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec Ref

|MSH |Message Header Segment | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|MSA |Message Acknowledgement | |2.15.8

|[ ERR ] |Error | |2.15.5

|link:#QAK[QAK] |Query Acknowledgement | |5.4.2

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|[ |--- ROW_DEFINITION begin | |

|link:#RDF[RDF] |Table Row Definition Segment | |5.5.6.6

|[ \{ link:#RDT[RDT] } ] |Table Row Data Segment | |5.5.6

|] |--- ROW_DEFINITION end | |

|[ DSC ] |Continuation Pointer | |2.15.4

|===

[width="100%",cols="21%,31%,24%,24%",options="header",]

|===

|Acknowledgement Choreography | | |

|RTB^Znn^RTB_K13 | | |

|Field name |Field Value: Original mode |Field value: Enhanced mode |

|MSH-15 |Blank |NE |AL, SU, ER

|MSH-16 |Blank |AL |AL

|Immediate Ack |- |- |ACK^Znn^ACK

|Application Ack |- |- |-

|===

*QPD Input Parameter Specification*

[width="100%",cols="11%,14%,8%,3%,6%,8%,3%,3%,8%,8%,9%,8%,11%",options="header",]

|===

|Field Seq (Query ID=Znn) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|1 |MessageQueryName | | |60 |CWE |R | | | | | |

|2 |QueryTag | | |32 |ST |R | | | | | |

|*3* |*InputItem . . .* | | | | | | | | | | |

|===

*QPD Input Parameter Field Description and Commentary*

[width="100%",cols="20%,12%,9%,59%",options="header",]

|===

|Input Parameter (Query ID=Znn) |Comp. Name |DT |Description

|*MessageQueryName* | |CWE |SHALL be valued *Znn^<query name>^HL7nnnn*.

|*QueryTag* | |ST |Unique to each query message instance.

|*InputItem1* | |DataType |

| | | |Components: (if applicable)

| | | |(Description)

| | | |(Valuation note)

| | | |

| |*Component1* (if applicable) |DataType |(Valuation note)

|===

{empty}[The following table is used only for the Complex Expression (QSC) variant.]

*Input Specification: Virtual Table*

[width="99%",cols="19%,9%,3%,6%,8%,3%,6%,8%,8%,10%,11%,9%",options="header",]

|===

|ColName (Query ID=Znn) a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

| | | | | | | | | | | |

|===

{empty}[The following table is used only for the Complex Expression (QSC) variant.]

*Virtual Table Field Description and Commentary*

[width="100%",cols="19%,11%,6%,64%",options="header",]

|===

|ColName (Query ID=Znn) |Comp. Name |DT |Description

| | | |

|===

{empty}[The following table is used only for the Query by Example variant.]

*QBE Input Parameter Specification*

[width="100%",cols="19%,18%,8%,6%,6%,7%,3%,3%,7%,5%,9%,9%",]

|===

|Segment Field Name (Query ID=Znn) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Service Identifier Code |Element Name

| | | | | | | | | | | |

|===

{empty}[The following table is used only for the Query by Example (QBE) variant.]

*QBE Input Parameter Field Description and Commentary*

[width="100%",cols="17%,11%,8%,64%",]

|===

|Input Parameter (Query ID=Znn) |Comp. Name |DT |Description

| | | |

|===

*RCP Response Control Parameter Field Description and Commentary*

[width="100%",cols="18%,23%,11%,5%,5%,38%",options="header",]

|===

|Field Seq (Query ID=Znn) |Name |Com­po­nent Name |LEN |DT |Description

| | | | | |

|===

*Output Specification and Commentary: Virtual Table*

[width="99%",cols="19%,9%,3%,6%,8%,3%,6%,8%,8%,10%,11%,9%",options="header",]

|===

|ColName (Query ID=Znn) a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

| | | | | | | | | | | |

|===

==== Query Profile template for query with segment pattern response

Query Profile

[width="100%",cols="39%,61%",options="header",]

|===

|Query Statement ID (Query ID=Znn): |

|Type: |

|Query Name: |

|Query Trigger (= MSH-9): |

|Query Mode: |

|Response Trigger (= MSH-9): |

|Query Characteristics: |

|Purpose: |

|Response Characteristics: |

|Based on Segment Pattern: |

|===

QBP^Znn^QBP_Q11: Query Grammar: QBP Message

[width="99%",cols="3%,31%,,47%,,9%,,10%",options="header",]

|===

|Segments | |Description | |Status | |Sec. Ref |

|MSH | |Message Header Segment | | | |2.15.9 |

|[\{ARV}] | |Access Restriction | | | |3 |

|[\{SFT}] | |Software Segment | | | |2.15.12 |

|[ UAC ] | |User Authentication Credential | | | |2.14.13 |

|link:#QPD[QPD] | |Query Parameter Definition | | | |5.5.4 |

|[ | |--- QBP begin | | | | |

|[...] | |Optional query by example segments | | | | |

|] | |--- QBP end | | | | |

|link:#RCP[RCP] | |Response Control Parameter | | | |5.5.6 |

|[ DSC ] | |Continuation Pointer | | | |2.15.4 |

|===

[width="100%",cols="21%,31%,24%,24%",options="header",]

|===

|Acknowledgement Choreography | | |

|QBP^Znn^QBP_Q11 | | |

|Field name |Field Value: Original mode |Field value: Enhanced mode |

|MSH-15 |Blank |NE |AL, SU, ER

|MSH-16 |Blank |AL |AL

|Immediate Ack |- |- |ACK^Znn^ACK

|Application Ack |RSP^Znn^RSP_Znn |RSP^Znn^RSP_Znn |RSP^Znn^RSP_Znn

|===

RSP^Znn^RSP_Znn: Response Grammar: RSP Message

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec Ref

|MSH |Message Header | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|[ UAC ] |User Authentication Credential | |2.14.13

|MSA |Message Acknowledgement | |2.15.8

|[ERR] |Error | |2.15.5

|link:#QAK[QAK] |Query Acknowledgement | |5.5.2

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|[...] |(additional segments according to the data to be produced) | |

|[ DSC ] |Continuation Pointer | |2.15.4

|===

[width="100%",cols="21%,31%,24%,24%",options="header",]

|===

|Acknowledgement Choreography | | |

|RSP^Znn^RSP_Znn | | |

|Field name |Field Value: Original mode |Field value: Enhanced mode |

|MSH-15 |Blank |NE |AL, SU, ER

|MSH-16 |Blank |AL |AL

|Immediate Ack |- |- |ACK^Znn^ACK

|Application Ack |- |- |-

|===

*QPD Input Parameter Specification*

[width="100%",cols="11%,14%,8%,3%,6%,8%,3%,3%,8%,8%,9%,8%,11%",options="header",]

|===

|Field Seq (Query ID=Znn) |Col Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|1 |MessageQueryName | | |60 |CWE |R | | | | | |

|2 |QueryTag | | |32 |ST |R | | | | | |

|3 |InputItem . . . | | | | | | | | | | |

|===

*QPD Input Parameter Field Description and Commentary*

[width="100%",cols="19%,12%,9%,60%",options="header",]

|===

|Input Parameter (Query ID=Znn) |Comp. Name |DT |Description

|MessageQueryName | |CWE |SHALL be valued *Znn^<query name>^HL7nnnn*.

|QueryTag | |ST |Unique to each query message instance.

|*InputItem1* | |DataType |

| | | |Components: (if applicable)

| | | |(Description)

| | | |(Valuation note)

| | | |

| |*Component1* (if applicable) |DataType |(Valuation note)

|===

{empty}[The following table is used only for the Complex Expression (QSC) variant.]

*Input Specification: Virtual Table*

[width="99%",cols="19%,9%,3%,6%,8%,3%,6%,8%,8%,10%,11%,9%",options="header",]

|===

|ColName (Query ID=Znn) a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

| | | | | | | | | | | |

|===

{empty}[The following table is used only for the Complex Expression (QSC) variant.]

*Virtual Table Field Description and Commentary*

[width="100%",cols="19%,11%,6%,64%",options="header",]

|===

|ColName (Query ID=Znn) |Comp. Name |DT |Description

| | | |

|===

{empty}[The following table is used only for the Query by Example (QBE) variant.]

*QBE Input Parameter Specification*

[width="100%",cols="19%,18%,8%,6%,6%,7%,3%,3%,7%,5%,9%,9%",]

|===

|Segment Field Name (Query ID=Znn) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Service Identifier Code |Element Name

| | | | | | | | | | | |

|===

{empty}[The following table is used only for the Query by Example variant.]

*QBE Input Parameter Field Description and Commentary*

[width="100%",cols="17%,11%,8%,64%",]

|===

|Input Parameter (Query ID=Znn) |Comp. Name |DT |Description

| | | |

|===

*RCP Response Control Parameter Field Description and Commentary*

[width="100%",cols="13%,28%,11%,5%,5%,38%",options="header",]

|===

|Field Seq (Query ID=Znn) |Name |Com­po­nent Name |LEN |DT |Description

| | | | | |

|===

==== Query Profile for query with display response

Query Profile

[width="100%",cols="39%,61%",options="header",]

|===

|Query Statement ID (Query ID=Znn): |

|Type: |

|Query Name: |

|Query Trigger (= MSH-9): |

|Query Mode: |

|Response Trigger (= MSH-9): |

|Query Characteristics: |

|Purpose: |

|Response Characteristics: |

|Based on Segment Pattern: |

|===

The message structure for QBP^Znn^QPB_Q15 can be found in 5.4.3. Use the QBP^Q15^QPB_Q15 Message structure.

RDY^Znn^RDY_K15: Response Grammar: RDY Message

[width="100%",cols="33%,47%,9%,11%",options="header",]

|===

|Segments |Description |Status |Sec Ref

|MSH |Message Header Segment | |2.15.9

|[\{SFT}] |Software Segment | |2.15.12

|MSA |Message Acknowledgement | |2.15.8

|[ ERR ] |Error | |2.15.5

|link:#QAK[QAK] |Query Acknowledgement | |5.5.2

|link:#QPD[QPD] |Query Parameter Definition | |5.5.4

|[\{ link:#DSP[DSP] }] |Display Data | |5.5.1

|[ DSC ] |Continuation Pointer | |2.15.4

|[ UAC ] |User Authentication Credential | |2.14.13

|===

[width="100%",cols="21%,31%,24%,24%",options="header",]

|===

|Acknowledgement Choreography | | |

|RDY^Znn^RDY_K15 | | |

|Field name |Field Value: Original mode |Field value: Enhanced mode |

|MSH-15 |Blank |NE |AL, SU, ER

|MSH-16 |Blank |AL |AL

|Immediate Ack |- |- |ACK^Znn^ACK

|Application Ack |- |- |-

|===

[width="100%",cols="100%",options="header",]

|===

|The data will display as follows: (Query ID=Znn)

|DSP\|\|\| (data in actual display format)

|===

*QPD Input Parameter Specification*

[width="100%",cols="11%,14%,8%,3%,6%,8%,3%,3%,8%,8%,9%,8%,11%",options="header",]

|===

|Field Seq (Query ID=Znn) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

|1 |MessageQueryName | | |60 |CWE |R | | | | | |

|2 |QueryTag | | |32 |ST |R | | | | | |

| |*InputItem* | | | | | | | | | | |

|===

*QPD Input Parameter Field Description and Commentary*

[width="100%",cols="19%,12%,9%,60%",options="header",]

|===

|Input Parameter (Query ID=Znn) |Comp. Name |DT |Description

|MessageQueryName | |CWE |SHALL be valued *Znn^<query name>^HL7nnnn*.

|QueryTag | |ST |Unique to each query message instance.

|*InputItem1* | |DataType |

| | | |Components: (if applicable)

| | | |(Description)

| | | |(Valuation note)

| | | |

| |*Component1* (if applicable) |DataType |(Valuation note)

|===

{empty}[The following table is used only for the Complex Expression (QSC) variant.]

*Input Specification: Virtual Table*

[width="99%",cols="19%,9%,3%,6%,8%,3%,6%,8%,8%,10%,11%,9%",options="header",]

|===

|ColName (Query ID=Znn) a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Segment Field Name |Service Identifier Code |Element Name

| | | | | | | | | | | |

|===

{empty}[The following table is used only for the Complex Expression (QSC) variant.]

[width="100%",cols="19%,11%,6%,64%",options="header",]

|===

|ColName (Query ID=Znn) |Comp. Name |DT |Description

| | | |

|===

{empty}[The following table is used only for the Query by Example (QBE) variant.]

*QBE Input Parameter Specification*

[width="100%",cols="19%,18%,8%,6%,6%,7%,3%,3%,7%,5%,9%,9%",]

|===

|Segment Field Name (Query ID=Znn) |Name a|

Key/

Search

|Sort |LEN |TYPE |Opt |Rep |Match Op |TBL |Service Identifier Code |Element Name

| | | | | | | | | | | |

|===

{empty}[The following table is used only for the Query by Example variant.]

*QBE Input Parameter Field Description and Commentary*

[width="100%",cols="17%,11%,8%,64%",]

|===

|Input Parameter (Query ID=Znn) |Comp. Name |DT |Description

| | | |

|===

*RCP Response Control Parameter Field Description and Commentary*

[width="100%",cols="13%,28%,11%,5%,5%,38%",options="header",]

|===

|Field Seq (Query ID=Znn) |Name |Com­po­nent Name |LEN |DT |Description

| | | | | |

|===

==== Query Profile table summaries

The following table lists the tables that are to be included in each Query Profile. The differences arise both from the query variant used and the response type provided.

[width="100%",cols="17%,14%,49%,20%",]

|===

|Response Type |Query Variant |Table Included |Section Reference

|Display |None (QPD) |Query Profile introduction |5.3.2.2

| | |Query grammar |5.3.2.3

| | |Response grammar for display response |5.3.2.5

| | |QPD input parameter specification |5.3.2.6

| | |QPD input parameter field description and commentary |5.3.2.7

| | |RCP input parameter field description and commentary |5.3.2.10

|Display |QBE |Query Profile introduction |5.3.2.2

| | |Query grammar |5.3.2.3

| | |Response grammar for display response |5.3.2.5

| | |QPD input parameter specification |5.3.2.6

| | |QPD input parameter field description and commentary |5.3.2.7

| | |QBE input parameter specification |5.3.2.8

| | |QBE input parameter field description and commentary |5.3.2.9

| | |RCP input parameter field description and commentary |5.3.2.10

|Display |QSC |Query Profile introduction |5.3.2.2

| | |Query grammar |5.3.2.3

| | |Response grammar for display response |5.3.2.5

| | |QPD input parameter specification |5.3.2.6

| | |QPD input parameter field description and commentary |5.3.2.7

| | |Input specification: virtual table |5.3.2.11

| | |Virtual table field description and commentary |5.3.2.12

|Tabular |None (QPD) |Query Profile introduction |5.3.2.2

| | |Query grammar |5.3.2.3

| | |Response grammar |5.3.2.4

| | |QPD input parameter specification |5.3.2.6

| | |QPD input parameter field description and commentary |5.3.2.7

| | |RCP input parameter field description and commentary |5.3.2.10

| | |Output specification for tabular response |5.3.2.13

|Tabular |QBE |Query Profile introduction |5.3.2.2

| | |Query grammar |5.3.2.3

| | |Response grammar |5.3.2.4

| | |QPD input parameter specification |5.3.2.6

| | |QPD input parameter field description and commentary |5.3.2.7

| | |QBE input parameter specification |5.3.2.8

| | |QBE input parameter field description and commentary |5.3.2.9

| | |RCP input parameter field description and commentary |5.3.2.10

| | |Output specification for tabular response |5.3.2.13

|Tabular |QSC |Query Profile introduction |5.3.2.2

| | |Query grammar |5.3.2.3

| | |Response grammar |5.3.2.4

| | |QPD input parameter specification |5.3.2.6

| | |QPD input parameter field description and commentary |5.3.2.7

| | |Input/output specification: virtual table |5.3.2.11

| | |Virtual table field description and commentary |5.3.2.12

| | |RCP input parameter field description and commentary |5.3.2.10

|Segment pattern |None (QPD) |Query Profile introduction |5.3.2.2

| | |Query grammar |5.3.2.3

| | |Response grammar |5.3.2.4

| | |QPD input parameter specification |5.3.2.6

| | |QPD input parameter field description and commentary |5.3.2.7

| | |RCP input parameter field description and commentary |5.3.2.10

|Segment pattern |QBE |Query Profile introduction |5.3.2.2

| | |Query grammar |5.3.2.3

| | |Response grammar |5.3.2.4

| | |QPD input parameter specification |5.3.2.6

| | |QPD input parameter field description and commentary |5.3.2.7

| | |QBE input parameter specification |5.3.2.8

| | |QBE input parameter field description and commentary |5.3.2.9

| | |RCP input parameter field description and commentary |5.3.2.10

|Segment pattern |QSC |Query Profile introduction |5.3.2.2

| | |Query grammar |5.3.2.3

| | |Response grammar |5.3.2.4

| | |QPD input parameter specification |5.3.2.6

| | |QPD input parameter field description and commentary |5.3.2.7

| | |Input specification: virtual table |5.3.2.11

| | |Virtual table field description and commentary |5.3.2.12

| | |RCP input parameter field description and commentary |5.3.2.10

|===

== QUERY/RESPONSE MESSAGE PAIRS

The query recommended for use in v 2.4 and later is the Query by Parameter (QBP). The query/response message pairs that follow in this section supersede the previous generation of original mode and enhanced queries that are described in sections _5.10.2_, "_Original mode queries_," and, in v 2.6 and preceding, 5.10.3, "Originally Mode Deferred Access," and 5.10.4, "Other Query/Response Message Segments."

All queries SHALL have a Query Name. The Query Name field, which is a CWE data type, uniquely identifies a Query Profile.

The QBP allows for several variants in defining the selection criteria.

The first variant, the Query by (Simple) Parameter, is to declare a sequence of one to many HL7 fields. Each of these fields will retain its data type as defined in the original HL7 usage. Each field corresponds to a parameter in the Query Profile.

*Note:* It is the responsibility of the Server to declare explicitly the purpose of the query, the meaning of each of the query parameters, and the relationships among the parameters. These declarations are made in the Query Profile.

A second variant, the Query by Example, allows the specification of parameters within actual HL7 segments other than the QPD. For example, the Query Profile might permit the use of the PID segment to transmit specific patient identification parameters. Each such parameter is specified in *the QBE Input Parameter Specification* and *QBE Input Parameter Field Description and Commentary* tables.

The third variant uses a single QPD parameter in the form of a complex query selection expression. This field with its QSC data type allows the defining segment to be broader in scope and allows any field in the target data to be selected and filtered unless constrained through the Query Profile. It explicitly states any relational operators such as AND and OR. It is intended to support a wide range of combinations of parameters.

The difference in how parameters are passed in each of these three variants is as follows:

Query by Simple Parameter passes each client value to the Server positionally using only the third and successive fields of the QPD segment.

Query by Example passes parameters using HL7 segments, such as PID, that are defined in the endpoint application chapters. The third and successive fields of the QPD segment also may be used in this variant.

In the QSC Selection Criteria variant, the parameter values are all contained within a single complex query selection expression that is passed in QPD-3.

Each generic query has a specific message syntax, a unique trigger event, and a unique message structure. Each generic response also has a specific message syntax, a unique trigger event, and a unique message structure.

There are three generic message structures, each of which accommodates the specific detail needed in each of the three response types.

The QBP_Q11 structure supports a Segment Pattern Response and contains the MSH, QPD, RCP, and DSC segments. Its default trigger event is Q11. A standard or site-defined query may use this trigger event or may specify a unique trigger event value in its Query Profile. If a unique trigger event value is chosen for a site-defined query, that value SHALL begin with Z.

The QBP_Q13 structure supports a Tabular Response and contains the MSH, RCP, RDF, and DSC segments. Its default trigger event is Q13. A standard or site-defined query may use this trigger event or may specify a unique trigger event value in its Query Profile. If a unique trigger event value is chosen for a site-defined query, that value SHALL begin with Z.

The QBP_Q15 structure supports a Display Response and contains the MSH, QPD, RCP, and DSC segments. Its default trigger event is Q15. A standard or site-defined query may use this trigger event or may specify a unique trigger event value in its Query Profile. If a unique trigger event value is chosen for a site-defined query, that value SHALL begin with Z.

The new queries support both immediate and deferred response. This information is carried in the RCP segment along with the execution date and time.

The query definition segment is echoed back in the response. This is particularly important in a continuation situation. Otherwise, the sender might conceivably have to manage a queue of queries.

== AUXILIARY QUERY PROTOCOLS

== PUBLISH AND SUBSCRIBE

